<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DI ÎèôÏùº (001530) Îç∞Ïù¥ÌÑ∞ ÏãúÍ∞ÅÌôî</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        min-height: 100vh;
        color: #333;
        line-height: 1.6;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 20px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        backdrop-filter: blur(10px);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      }

      .header {
        background: white;
        color: #2c3e50;
        padding: 40px 30px;
        border-radius: 20px;
        text-align: center;
        margin-bottom: 30px;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        border: 2px solid #e8e8e8;
      }

      .header h1 {
        font-size: 3em;
        font-weight: 300;
        margin-bottom: 10px;
        text-shadow: none;
        color: #2c3e50;
      }

      .header p {
        font-size: 1.2em;
        opacity: 0.8;
        color: #555;
      }

      .badge {
        display: inline-block;
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
        padding: 8px 20px;
        border-radius: 25px;
        font-size: 0.9em;
        font-weight: bold;
        margin-top: 15px;
        box-shadow: 0 4px 15px rgba(39, 174, 96, 0.3);
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin: 30px 0;
      }

      .stat-card {
        background: white;
        padding: 25px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        text-align: center;
        transition: all 0.3s ease;
      }

      .stat-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
      }

      .stat-label {
        color: #7f8c8d;
        font-size: 0.9em;
        text-transform: uppercase;
        letter-spacing: 1px;
        margin-bottom: 10px;
        font-weight: 600;
      }

      .stat-value {
        font-size: 2.2em;
        font-weight: bold;
        color: #2c3e50;
        margin: 10px 0;
      }

      .controls {
        text-align: center;
        margin: 40px 0;
      }

      .btn {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        border: none;
        padding: 15px 30px;
        margin: 8px;
        border-radius: 30px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
      }

      .btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
      }

      .btn.active {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
      }

      .chart-container {
        background: white;
        padding: 30px;
        border-radius: 20px;
        margin: 20px 0;
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
      }

      .chart-title {
        font-size: 1.8em;
        color: #2c3e50;
        margin-bottom: 25px;
        text-align: center;
        font-weight: 400;
      }

      .chart-wrapper {
        position: relative;
        height: 450px;
        margin-bottom: 20px;
      }

      .footer {
        background: rgba(44, 62, 80, 0.9);
        color: white;
        text-align: center;
        padding: 25px;
        border-radius: 15px;
        margin-top: 40px;
      }

      /* AI Î∂ÑÏÑù Ïä§ÌÉÄÏùº */
      .ai-analysis-container {
        background: white;
        border-radius: 15px;
        padding: 30px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        border: 2px solid #e8e8e8;
      }

      .analysis-loading {
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #8e44ad;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .analysis-content {
        animation: fadeIn 0.8s ease-in;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .analysis-section {
        margin-bottom: 30px;
        padding: 25px;
        background: #f8f9fa;
        border-radius: 12px;
        border-left: 5px solid #8e44ad;
      }

      .analysis-section h3 {
        color: #8e44ad;
        margin-bottom: 15px;
        font-size: 1.3em;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .analysis-section p {
        line-height: 1.6;
        color: #2c3e50;
        margin-bottom: 10px;
      }

      .signal-indicator {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: bold;
        font-size: 0.9em;
        margin: 5px;
      }

      .signal-buy {
        background: #e8f5e8;
        color: #27ae60;
        border: 2px solid #27ae60;
      }
      .signal-sell {
        background: #fdf2f2;
        color: #e74c3c;
        border: 2px solid #e74c3c;
      }
      .signal-hold {
        background: #fff3cd;
        color: #856404;
        border: 2px solid #ffc107;
      }

      .news-item {
        background: white;
        border-radius: 8px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid #3498db;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .news-title {
        font-weight: bold;
        color: #2c3e50;
        margin-bottom: 8px;
        font-size: 1.1em;
      }

      .news-title a {
        color: #2c3e50;
        text-decoration: none;
        transition: color 0.3s ease;
      }

      .news-title a:hover {
        color: #3498db;
        text-decoration: underline;
      }

      .news-summary {
        color: #555;
        font-size: 0.95em;
        line-height: 1.5;
      }

      .news-date {
        color: #999;
        font-size: 0.85em;
        margin-top: 8px;
      }

      @media (max-width: 768px) {
        .header h1 {
          font-size: 2em;
        }
        .chart-wrapper {
          height: 350px;
        }
        .stats-grid {
          grid-template-columns: repeat(2, 1fr);
          gap: 15px;
        }
        .stat-card {
          padding: 20px;
        }
        .stat-value {
          font-size: 1.8em;
        }
        .btn {
          padding: 12px 20px;
          font-size: 14px;
        }
      }

      .chart-section {
        animation: fadeIn 0.5s ease-in-out;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1>
          <img
            src="CI.png"
            alt="DI"
            style="
              height: 85px;
              width: 105px;
              margin-right: 35px;
              vertical-align: middle;
            "
          />
          <p
            style="
              font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
              font-weight: 700;
              letter-spacing: 0.5px;
            "
          >
            DI ÎèôÏùº (001530)
          </p>
        </h1>
        <p
          style="
            font-family: 'Segoe UI', 'Helvetica Neue', Arial, sans-serif;
            font-weight: 500;
            letter-spacing: 0.5px;
          "
        >
          Ïã§ÏãúÍ∞Ñ Ï£ºÏãù Îç∞Ïù¥ÌÑ∞ ÏãúÍ∞ÅÌôî ÎåÄÏãúÎ≥¥Îìú
        </p>
        <div class="badge">
          ‚ú® Í∞ÄÍ≤© Î∞è ÏßÄÌëú + Í±∞ÎûòÎüâ + MACD + RCI + Ïô∏Íµ≠Ïù∏Î≥¥Ïú†Ïú®
        </div>
      </div>

      <div class="stats-grid" id="statsGrid"></div>

      <div class="controls">
        <button class="btn active" onclick="showChart('price')">
          üìà Í∞ÄÍ≤© Ï∞®Ìä∏
        </button>
        <button class="btn" onclick="showChart('volume')">
          üìä Í±∞ÎûòÎüâ Ï∞®Ìä∏
        </button>
        <button class="btn" onclick="showChart('macd')">üìà MACD Ï∞®Ìä∏</button>
        <button class="btn" onclick="showChart('rci')">üìä RCI Ï∞®Ìä∏</button>
        <button class="btn" onclick="showChart('foreign')">
          üåç Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú®
        </button>
        <button class="btn" onclick="showChart('all')">üìã Ï†ÑÏ≤¥ Î≥¥Í∏∞</button>
        <button
          class="btn ai-analysis-btn"
          onclick="showAIAnalysis()"
          style="
            background: linear-gradient(135deg, #8e44ad 0%, #9b59b6 100%);
            margin-left: 10px;
          "
        >
          ü§ñ AI Ï£ºÍ∞Ä Î∂ÑÏÑù
        </button>
      </div>

      <div class="chart-container">
        <div id="priceChart" class="chart-section">
          <div class="chart-title">
            üìà Ï£ºÍ∞Ä Ï∂îÏù¥ + Ïù¥ÎèôÌèâÍ∑†ÏÑ† + ÏùºÎ™©Í∑†ÌòïÌëú (Íµ¨Î¶ÑÎåÄ)
          </div>
          <div class="chart-wrapper">
            <canvas id="candlestickChart"></canvas>
          </div>
        </div>

        <div id="volumeChart" class="chart-section" style="display: none">
          <div class="chart-title">üìä ÏùºÎ≥Ñ Í±∞ÎûòÎüâ</div>
          <div class="chart-wrapper">
            <canvas id="volumeChartCanvas"></canvas>
          </div>
        </div>

        <div id="macdChart" class="chart-section" style="display: none">
          <div class="chart-title">üìà MACD Ïò§Ïã§Î†àÏù¥ÌÑ∞ (12,26,9)</div>
          <div class="chart-wrapper">
            <canvas id="macdChartCanvas"></canvas>
          </div>
        </div>

        <div id="rciChart" class="chart-section" style="display: none">
          <div class="chart-title">üìä RCI Ï∞®Ìä∏ (9,13,18,26)</div>
          <div class="chart-wrapper">
            <canvas id="rciChartCanvas"></canvas>
          </div>
        </div>

        <div id="foreignChart" class="chart-section" style="display: none">
          <div class="chart-title">üåç Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú® Î≥ÄÌôî</div>
          <div class="chart-wrapper">
            <canvas id="foreignChartCanvas"></canvas>
          </div>
        </div>

        <!-- AI Î∂ÑÏÑù ÏÑπÏÖò -->
        <div id="aiAnalysisSection" class="chart-section" style="display: none">
          <div class="chart-title">ü§ñ AI Ï£ºÍ∞Ä Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</div>
          <div class="ai-analysis-container">
            <div class="analysis-loading" id="analysisLoading">
              <div class="spinner"></div>
              <p>üìä Ï∞®Ìä∏ Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Ï§ë...</p>
              <p>üî§ DIÎèôÏùº ÌïµÏã¨ ÌÇ§ÏõåÎìú Î∂ÑÏÑù Ï§ë...</p>
              <p>üìà Í∏∞Ïà†Ï†Å ÏßÄÌëú Ï¢ÖÌï© ÌèâÍ∞Ä Ï§ë...</p>
              <p>ü§ñ AI Ï¢ÖÌï© Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏ ÏÉùÏÑ± Ï§ë...</p>
            </div>
            <div
              class="analysis-content"
              id="analysisContent"
              style="display: none"
            >
              <!-- Î∂ÑÏÑù Í≤∞Í≥ºÍ∞Ä Ïó¨Í∏∞Ïóê ÎèôÏ†ÅÏúºÎ°ú ÏÉùÏÑ±Îê©ÎãàÎã§ -->
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <p>
          ¬© 2025 DI Ï£ºÏãù ÏãúÍ∞ÅÌôî ÎèÑÍµ¨ | ÎÑ§Ïù¥Î≤Ñ Í∏àÏúµ API Í∏∞Î∞ò | Make by Bjkim
          Ìè¨Ïù∏Ìä∏
        </p>
      </div>
    </div>

    <script>
      // üéØ DI Ï£ºÏãù Ï†ÑÏ≤¥ Îç∞Ïù¥ÌÑ∞ (2025.03.28 ~ 2025.09.05, 93Í∞ú Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏)
      const stockData = [
        {
          localDate: "20250328",
          closePrice: 48200.0,
          openPrice: 47050.0,
          highPrice: 48750.0,
          lowPrice: 46000.0,
          accumulatedTradingVolume: 165612,
          foreignRetentionRate: 9.28,
        },
        {
          localDate: "20250331",
          closePrice: 46800.0,
          openPrice: 48000.0,
          highPrice: 48000.0,
          lowPrice: 45450.0,
          accumulatedTradingVolume: 100457,
          foreignRetentionRate: 8.93,
        },
        {
          localDate: "20250401",
          closePrice: 46750.0,
          openPrice: 46500.0,
          highPrice: 46750.0,
          lowPrice: 45450.0,
          accumulatedTradingVolume: 93507,
          foreignRetentionRate: 8.72,
        },
        {
          localDate: "20250402",
          closePrice: 46500.0,
          openPrice: 46550.0,
          highPrice: 46900.0,
          lowPrice: 45750.0,
          accumulatedTradingVolume: 39580,
          foreignRetentionRate: 8.64,
        },
        {
          localDate: "20250403",
          closePrice: 46350.0,
          openPrice: 46400.0,
          highPrice: 46450.0,
          lowPrice: 45400.0,
          accumulatedTradingVolume: 36570,
          foreignRetentionRate: 8.55,
        },
        {
          localDate: "20250404",
          closePrice: 44850.0,
          openPrice: 45550.0,
          highPrice: 46350.0,
          lowPrice: 43000.0,
          accumulatedTradingVolume: 89216,
          foreignRetentionRate: 8.39,
        },
        {
          localDate: "20250407",
          closePrice: 43050.0,
          openPrice: 43000.0,
          highPrice: 44650.0,
          lowPrice: 41450.0,
          accumulatedTradingVolume: 47568,
          foreignRetentionRate: 8.28,
        },
        {
          localDate: "20250408",
          closePrice: 43000.0,
          openPrice: 43200.0,
          highPrice: 44150.0,
          lowPrice: 42750.0,
          accumulatedTradingVolume: 39016,
          foreignRetentionRate: 8.26,
        },
        {
          localDate: "20250409",
          closePrice: 40350.0,
          openPrice: 43000.0,
          highPrice: 43950.0,
          lowPrice: 39950.0,
          accumulatedTradingVolume: 54459,
          foreignRetentionRate: 8.2,
        },
        {
          localDate: "20250410",
          closePrice: 41350.0,
          openPrice: 41500.0,
          highPrice: 42500.0,
          lowPrice: 39850.0,
          accumulatedTradingVolume: 45027,
          foreignRetentionRate: 8.17,
        },
        {
          localDate: "20250411",
          closePrice: 42850.0,
          openPrice: 40350.0,
          highPrice: 42850.0,
          lowPrice: 40350.0,
          accumulatedTradingVolume: 31518,
          foreignRetentionRate: 8.18,
        },
        {
          localDate: "20250414",
          closePrice: 42700.0,
          openPrice: 42300.0,
          highPrice: 42850.0,
          lowPrice: 41350.0,
          accumulatedTradingVolume: 34550,
          foreignRetentionRate: 8.11,
        },
        {
          localDate: "20250415",
          closePrice: 42600.0,
          openPrice: 41750.0,
          highPrice: 42700.0,
          lowPrice: 41600.0,
          accumulatedTradingVolume: 31964,
          foreignRetentionRate: 8.09,
        },
        {
          localDate: "20250416",
          closePrice: 42500.0,
          openPrice: 41800.0,
          highPrice: 42600.0,
          lowPrice: 41600.0,
          accumulatedTradingVolume: 27252,
          foreignRetentionRate: 8.07,
        },
        {
          localDate: "20250417",
          closePrice: 42400.0,
          openPrice: 41600.0,
          highPrice: 42600.0,
          lowPrice: 41600.0,
          accumulatedTradingVolume: 32355,
          foreignRetentionRate: 7.99,
        },
        {
          localDate: "20250418",
          closePrice: 43950.0,
          openPrice: 41850.0,
          highPrice: 44350.0,
          lowPrice: 41850.0,
          accumulatedTradingVolume: 32071,
          foreignRetentionRate: 8.06,
        },
        {
          localDate: "20250421",
          closePrice: 43950.0,
          openPrice: 44000.0,
          highPrice: 44500.0,
          lowPrice: 43500.0,
          accumulatedTradingVolume: 30954,
          foreignRetentionRate: 8.0,
        },
        {
          localDate: "20250422",
          closePrice: 43900.0,
          openPrice: 43400.0,
          highPrice: 44000.0,
          lowPrice: 43400.0,
          accumulatedTradingVolume: 13147,
          foreignRetentionRate: 7.97,
        },
        {
          localDate: "20250423",
          closePrice: 43850.0,
          openPrice: 43450.0,
          highPrice: 43950.0,
          lowPrice: 41850.0,
          accumulatedTradingVolume: 31685,
          foreignRetentionRate: 7.97,
        },
        {
          localDate: "20250424",
          closePrice: 43750.0,
          openPrice: 44000.0,
          highPrice: 44100.0,
          lowPrice: 43200.0,
          accumulatedTradingVolume: 23492,
          foreignRetentionRate: 7.8,
        },
        {
          localDate: "20250425",
          closePrice: 43850.0,
          openPrice: 44300.0,
          highPrice: 45500.0,
          lowPrice: 43600.0,
          accumulatedTradingVolume: 45940,
          foreignRetentionRate: 7.84,
        },
        {
          localDate: "20250428",
          closePrice: 41650.0,
          openPrice: 43450.0,
          highPrice: 43450.0,
          lowPrice: 41350.0,
          accumulatedTradingVolume: 85026,
          foreignRetentionRate: 7.67,
        },
        {
          localDate: "20250429",
          closePrice: 41600.0,
          openPrice: 41050.0,
          highPrice: 41600.0,
          lowPrice: 38200.0,
          accumulatedTradingVolume: 175153,
          foreignRetentionRate: 7.76,
        },
        {
          localDate: "20250430",
          closePrice: 41350.0,
          openPrice: 40750.0,
          highPrice: 41450.0,
          lowPrice: 40450.0,
          accumulatedTradingVolume: 31899,
          foreignRetentionRate: 7.72,
        },
        {
          localDate: "20250502",
          closePrice: 41100.0,
          openPrice: 41200.0,
          highPrice: 41250.0,
          lowPrice: 40550.0,
          accumulatedTradingVolume: 30212,
          foreignRetentionRate: 7.68,
        },
        {
          localDate: "20250507",
          closePrice: 40600.0,
          openPrice: 40250.0,
          highPrice: 40950.0,
          lowPrice: 39850.0,
          accumulatedTradingVolume: 24761,
          foreignRetentionRate: 7.54,
        },
        {
          localDate: "20250508",
          closePrice: 40250.0,
          openPrice: 40000.0,
          highPrice: 40500.0,
          lowPrice: 40000.0,
          accumulatedTradingVolume: 18034,
          foreignRetentionRate: 7.53,
        },
        {
          localDate: "20250509",
          closePrice: 39750.0,
          openPrice: 39800.0,
          highPrice: 40900.0,
          lowPrice: 38500.0,
          accumulatedTradingVolume: 51566,
          foreignRetentionRate: 7.49,
        },
        {
          localDate: "20250512",
          closePrice: 36000.0,
          openPrice: 39050.0,
          highPrice: 39450.0,
          lowPrice: 34500.0,
          accumulatedTradingVolume: 143880,
          foreignRetentionRate: 7.52,
        },
        {
          localDate: "20250513",
          closePrice: 35750.0,
          openPrice: 36000.0,
          highPrice: 36800.0,
          lowPrice: 35550.0,
          accumulatedTradingVolume: 24437,
          foreignRetentionRate: 7.54,
        },
        {
          localDate: "20250514",
          closePrice: 36250.0,
          openPrice: 35500.0,
          highPrice: 36400.0,
          lowPrice: 35400.0,
          accumulatedTradingVolume: 30041,
          foreignRetentionRate: 7.54,
        },
        {
          localDate: "20250515",
          closePrice: 35900.0,
          openPrice: 36000.0,
          highPrice: 36700.0,
          lowPrice: 35550.0,
          accumulatedTradingVolume: 17037,
          foreignRetentionRate: 7.46,
        },
        {
          localDate: "20250516",
          closePrice: 37100.0,
          openPrice: 35550.0,
          highPrice: 37350.0,
          lowPrice: 35350.0,
          accumulatedTradingVolume: 45500,
          foreignRetentionRate: 7.56,
        },
        {
          localDate: "20250519",
          closePrice: 37100.0,
          openPrice: 36400.0,
          highPrice: 37250.0,
          lowPrice: 35500.0,
          accumulatedTradingVolume: 27433,
          foreignRetentionRate: 7.55,
        },
        {
          localDate: "20250520",
          closePrice: 37050.0,
          openPrice: 36650.0,
          highPrice: 37250.0,
          lowPrice: 36450.0,
          accumulatedTradingVolume: 27063,
          foreignRetentionRate: 7.71,
        },
        {
          localDate: "20250521",
          closePrice: 36850.0,
          openPrice: 36600.0,
          highPrice: 36950.0,
          lowPrice: 36300.0,
          accumulatedTradingVolume: 31668,
          foreignRetentionRate: 7.65,
        },
        {
          localDate: "20250522",
          closePrice: 36800.0,
          openPrice: 36400.0,
          highPrice: 36850.0,
          lowPrice: 36100.0,
          accumulatedTradingVolume: 40509,
          foreignRetentionRate: 7.54,
        },
        {
          localDate: "20250523",
          closePrice: 37050.0,
          openPrice: 36500.0,
          highPrice: 37450.0,
          lowPrice: 36500.0,
          accumulatedTradingVolume: 33283,
          foreignRetentionRate: 7.62,
        },
        {
          localDate: "20250526",
          closePrice: 37000.0,
          openPrice: 36600.0,
          highPrice: 37500.0,
          lowPrice: 36350.0,
          accumulatedTradingVolume: 68069,
          foreignRetentionRate: 7.56,
        },
        {
          localDate: "20250527",
          closePrice: 35750.0,
          openPrice: 37400.0,
          highPrice: 37400.0,
          lowPrice: 35350.0,
          accumulatedTradingVolume: 47119,
          foreignRetentionRate: 7.47,
        },
        {
          localDate: "20250528",
          closePrice: 33600.0,
          openPrice: 35800.0,
          highPrice: 35800.0,
          lowPrice: 33350.0,
          accumulatedTradingVolume: 78147,
          foreignRetentionRate: 7.49,
        },
        {
          localDate: "20250529",
          closePrice: 33150.0,
          openPrice: 33700.0,
          highPrice: 33850.0,
          lowPrice: 31050.0,
          accumulatedTradingVolume: 81212,
          foreignRetentionRate: 7.53,
        },
        {
          localDate: "20250530",
          closePrice: 33300.0,
          openPrice: 33400.0,
          highPrice: 33700.0,
          lowPrice: 32550.0,
          accumulatedTradingVolume: 45132,
          foreignRetentionRate: 7.41,
        },
        {
          localDate: "20250602",
          closePrice: 33800.0,
          openPrice: 33100.0,
          highPrice: 34100.0,
          lowPrice: 32800.0,
          accumulatedTradingVolume: 31153,
          foreignRetentionRate: 7.46,
        },
        {
          localDate: "20250604",
          closePrice: 33900.0,
          openPrice: 33450.0,
          highPrice: 34350.0,
          lowPrice: 33450.0,
          accumulatedTradingVolume: 26410,
          foreignRetentionRate: 7.39,
        },
        {
          localDate: "20250605",
          closePrice: 34750.0,
          openPrice: 33550.0,
          highPrice: 35200.0,
          lowPrice: 33550.0,
          accumulatedTradingVolume: 31491,
          foreignRetentionRate: 7.4,
        },
        {
          localDate: "20250609",
          closePrice: 37200.0,
          openPrice: 35750.0,
          highPrice: 37900.0,
          lowPrice: 35000.0,
          accumulatedTradingVolume: 52567,
          foreignRetentionRate: 7.3,
        },
        {
          localDate: "20250610",
          closePrice: 37400.0,
          openPrice: 37400.0,
          highPrice: 37500.0,
          lowPrice: 36700.0,
          accumulatedTradingVolume: 30804,
          foreignRetentionRate: 7.27,
        },
        {
          localDate: "20250611",
          closePrice: 38450.0,
          openPrice: 37400.0,
          highPrice: 38700.0,
          lowPrice: 37200.0,
          accumulatedTradingVolume: 48908,
          foreignRetentionRate: 7.37,
        },
        {
          localDate: "20250612",
          closePrice: 38300.0,
          openPrice: 38200.0,
          highPrice: 39250.0,
          lowPrice: 37900.0,
          accumulatedTradingVolume: 50411,
          foreignRetentionRate: 7.26,
        },
        {
          localDate: "20250613",
          closePrice: 37700.0,
          openPrice: 38300.0,
          highPrice: 38300.0,
          lowPrice: 35400.0,
          accumulatedTradingVolume: 107727,
          foreignRetentionRate: 7.02,
        },
        {
          localDate: "20250616",
          closePrice: 37750.0,
          openPrice: 36550.0,
          highPrice: 37900.0,
          lowPrice: 36300.0,
          accumulatedTradingVolume: 42671,
          foreignRetentionRate: 7.04,
        },
        {
          localDate: "20250617",
          closePrice: 38700.0,
          openPrice: 37800.0,
          highPrice: 39100.0,
          lowPrice: 37350.0,
          accumulatedTradingVolume: 64806,
          foreignRetentionRate: 7.43,
        },
        {
          localDate: "20250618",
          closePrice: 38600.0,
          openPrice: 38150.0,
          highPrice: 38950.0,
          lowPrice: 38100.0,
          accumulatedTradingVolume: 20250,
          foreignRetentionRate: 7.35,
        },
        {
          localDate: "20250619",
          closePrice: 38950.0,
          openPrice: 38300.0,
          highPrice: 38950.0,
          lowPrice: 38100.0,
          accumulatedTradingVolume: 21327,
          foreignRetentionRate: 7.33,
        },
        {
          localDate: "20250620",
          closePrice: 39000.0,
          openPrice: 38900.0,
          highPrice: 39600.0,
          lowPrice: 38700.0,
          accumulatedTradingVolume: 78255,
          foreignRetentionRate: 7.27,
        },
        {
          localDate: "20250623",
          closePrice: 38600.0,
          openPrice: 38650.0,
          highPrice: 39000.0,
          lowPrice: 38250.0,
          accumulatedTradingVolume: 51351,
          foreignRetentionRate: 7.25,
        },
        {
          localDate: "20250624",
          closePrice: 38700.0,
          openPrice: 38600.0,
          highPrice: 39400.0,
          lowPrice: 37300.0,
          accumulatedTradingVolume: 92583,
          foreignRetentionRate: 7.11,
        },
        {
          localDate: "20250625",
          closePrice: 39400.0,
          openPrice: 38400.0,
          highPrice: 39750.0,
          lowPrice: 37900.0,
          accumulatedTradingVolume: 72831,
          foreignRetentionRate: 7.26,
        },
        {
          localDate: "20250626",
          closePrice: 39250.0,
          openPrice: 39500.0,
          highPrice: 39650.0,
          lowPrice: 38300.0,
          accumulatedTradingVolume: 41423,
          foreignRetentionRate: 7.16,
        },
        {
          localDate: "20250627",
          closePrice: 39550.0,
          openPrice: 40000.0,
          highPrice: 40500.0,
          lowPrice: 39500.0,
          accumulatedTradingVolume: 54263,
          foreignRetentionRate: 7.05,
        },
        {
          localDate: "20250630",
          closePrice: 38700.0,
          openPrice: 39450.0,
          highPrice: 39450.0,
          lowPrice: 38250.0,
          accumulatedTradingVolume: 70422,
          foreignRetentionRate: 6.87,
        },
        {
          localDate: "20250701",
          closePrice: 42000.0,
          openPrice: 39800.0,
          highPrice: 42000.0,
          lowPrice: 38200.0,
          accumulatedTradingVolume: 209434,
          foreignRetentionRate: 7.33,
        },
        {
          localDate: "20250702",
          closePrice: 40900.0,
          openPrice: 41550.0,
          highPrice: 41850.0,
          lowPrice: 40000.0,
          accumulatedTradingVolume: 95103,
          foreignRetentionRate: 7.08,
        },
        {
          localDate: "20250703",
          closePrice: 42000.0,
          openPrice: 41300.0,
          highPrice: 42000.0,
          lowPrice: 40500.0,
          accumulatedTradingVolume: 50219,
          foreignRetentionRate: 7.09,
        },
        {
          localDate: "20250704",
          closePrice: 40900.0,
          openPrice: 42150.0,
          highPrice: 42150.0,
          lowPrice: 40050.0,
          accumulatedTradingVolume: 66830,
          foreignRetentionRate: 6.87,
        },
        {
          localDate: "20250707",
          closePrice: 40950.0,
          openPrice: 40500.0,
          highPrice: 41900.0,
          lowPrice: 40000.0,
          accumulatedTradingVolume: 35668,
          foreignRetentionRate: 6.88,
        },
        {
          localDate: "20250708",
          closePrice: 41650.0,
          openPrice: 41100.0,
          highPrice: 41950.0,
          lowPrice: 39450.0,
          accumulatedTradingVolume: 90548,
          foreignRetentionRate: 6.96,
        },
        {
          localDate: "20250709",
          closePrice: 42050.0,
          openPrice: 42150.0,
          highPrice: 42650.0,
          lowPrice: 41350.0,
          accumulatedTradingVolume: 67182,
          foreignRetentionRate: 6.84,
        },
        {
          localDate: "20250710",
          closePrice: 42450.0,
          openPrice: 41850.0,
          highPrice: 42500.0,
          lowPrice: 41500.0,
          accumulatedTradingVolume: 66321,
          foreignRetentionRate: 6.91,
        },
        {
          localDate: "20250711",
          closePrice: 42450.0,
          openPrice: 42450.0,
          highPrice: 42750.0,
          lowPrice: 42000.0,
          accumulatedTradingVolume: 58548,
          foreignRetentionRate: 6.92,
        },
        {
          localDate: "20250714",
          closePrice: 42250.0,
          openPrice: 42450.0,
          highPrice: 42900.0,
          lowPrice: 42200.0,
          accumulatedTradingVolume: 23005,
          foreignRetentionRate: 6.89,
        },
        {
          localDate: "20250715",
          closePrice: 42450.0,
          openPrice: 42000.0,
          highPrice: 42450.0,
          lowPrice: 41800.0,
          accumulatedTradingVolume: 16760,
          foreignRetentionRate: 6.89,
        },
        {
          localDate: "20250716",
          closePrice: 42450.0,
          openPrice: 42400.0,
          highPrice: 42750.0,
          lowPrice: 41950.0,
          accumulatedTradingVolume: 26153,
          foreignRetentionRate: 6.85,
        },
        {
          localDate: "20250717",
          closePrice: 42350.0,
          openPrice: 42500.0,
          highPrice: 42550.0,
          lowPrice: 41300.0,
          accumulatedTradingVolume: 38763,
          foreignRetentionRate: 6.78,
        },
        {
          localDate: "20250718",
          closePrice: 42850.0,
          openPrice: 42250.0,
          highPrice: 43050.0,
          lowPrice: 41800.0,
          accumulatedTradingVolume: 60705,
          foreignRetentionRate: 6.95,
        },
        {
          localDate: "20250721",
          closePrice: 42950.0,
          openPrice: 43200.0,
          highPrice: 43400.0,
          lowPrice: 42600.0,
          accumulatedTradingVolume: 63986,
          foreignRetentionRate: 6.91,
        },
        {
          localDate: "20250722",
          closePrice: 42850.0,
          openPrice: 42850.0,
          highPrice: 43000.0,
          lowPrice: 42200.0,
          accumulatedTradingVolume: 33279,
          foreignRetentionRate: 6.84,
        },
        {
          localDate: "20250723",
          closePrice: 42550.0,
          openPrice: 42850.0,
          highPrice: 43350.0,
          lowPrice: 41950.0,
          accumulatedTradingVolume: 26109,
          foreignRetentionRate: 6.8,
        },
        {
          localDate: "20250724",
          closePrice: 42600.0,
          openPrice: 42750.0,
          highPrice: 42900.0,
          lowPrice: 42300.0,
          accumulatedTradingVolume: 42860,
          foreignRetentionRate: 6.85,
        },
        {
          localDate: "20250725",
          closePrice: 42550.0,
          openPrice: 42600.0,
          highPrice: 42700.0,
          lowPrice: 42400.0,
          accumulatedTradingVolume: 20389,
          foreignRetentionRate: 6.85,
        },
        {
          localDate: "20250728",
          closePrice: 42400.0,
          openPrice: 42650.0,
          highPrice: 42650.0,
          lowPrice: 40850.0,
          accumulatedTradingVolume: 114448,
          foreignRetentionRate: 6.72,
        },
        {
          localDate: "20250729",
          closePrice: 42300.0,
          openPrice: 42600.0,
          highPrice: 42600.0,
          lowPrice: 41300.0,
          accumulatedTradingVolume: 50607,
          foreignRetentionRate: 6.63,
        },
        {
          localDate: "20250730",
          closePrice: 43300.0,
          openPrice: 42250.0,
          highPrice: 43450.0,
          lowPrice: 42250.0,
          accumulatedTradingVolume: 73433,
          foreignRetentionRate: 6.88,
        },
        {
          localDate: "20250731",
          closePrice: 42750.0,
          openPrice: 43500.0,
          highPrice: 43500.0,
          lowPrice: 42600.0,
          accumulatedTradingVolume: 34949,
          foreignRetentionRate: 6.83,
        },
        {
          localDate: "20250801",
          closePrice: 42200.0,
          openPrice: 42000.0,
          highPrice: 42750.0,
          lowPrice: 41850.0,
          accumulatedTradingVolume: 55785,
          foreignRetentionRate: 6.76,
        },
        {
          localDate: "20250804",
          closePrice: 42250.0,
          openPrice: 41550.0,
          highPrice: 42400.0,
          lowPrice: 40350.0,
          accumulatedTradingVolume: 48644,
          foreignRetentionRate: 6.61,
        },
        {
          localDate: "20250805",
          closePrice: 43100.0,
          openPrice: 42050.0,
          highPrice: 44050.0,
          lowPrice: 41850.0,
          accumulatedTradingVolume: 90948,
          foreignRetentionRate: 6.64,
        },
        {
          localDate: "20250806",
          closePrice: 43050.0,
          openPrice: 42800.0,
          highPrice: 43150.0,
          lowPrice: 42100.0,
          accumulatedTradingVolume: 30739,
          foreignRetentionRate: 6.58,
        },
        {
          localDate: "20250807",
          closePrice: 43300.0,
          openPrice: 42900.0,
          highPrice: 43500.0,
          lowPrice: 42850.0,
          accumulatedTradingVolume: 32522,
          foreignRetentionRate: 6.63,
        },
        {
          localDate: "20250808",
          closePrice: 43350.0,
          openPrice: 43200.0,
          highPrice: 43800.0,
          lowPrice: 43200.0,
          accumulatedTradingVolume: 25083,
          foreignRetentionRate: 6.84,
        },
        {
          localDate: "20250811",
          closePrice: 42900.0,
          openPrice: 43950.0,
          highPrice: 43950.0,
          lowPrice: 42750.0,
          accumulatedTradingVolume: 25649,
          foreignRetentionRate: 6.77,
        },
        {
          localDate: "20250812",
          closePrice: 42700.0,
          openPrice: 41900.0,
          highPrice: 42900.0,
          lowPrice: 41550.0,
          accumulatedTradingVolume: 75749,
          foreignRetentionRate: 6.58,
        },
        {
          localDate: "20250813",
          closePrice: 42650.0,
          openPrice: 42050.0,
          highPrice: 43000.0,
          lowPrice: 42050.0,
          accumulatedTradingVolume: 36608,
          foreignRetentionRate: 6.62,
        },
        {
          localDate: "20250814",
          closePrice: 43150.0,
          openPrice: 42500.0,
          highPrice: 43700.0,
          lowPrice: 42500.0,
          accumulatedTradingVolume: 61445,
          foreignRetentionRate: 6.74,
        },
        {
          localDate: "20250818",
          closePrice: 41100.0,
          openPrice: 43400.0,
          highPrice: 43650.0,
          lowPrice: 40500.0,
          accumulatedTradingVolume: 98075,
          foreignRetentionRate: 6.39,
        },
        {
          localDate: "20250819",
          closePrice: 41000.0,
          openPrice: 40550.0,
          highPrice: 41250.0,
          lowPrice: 40050.0,
          accumulatedTradingVolume: 41443,
          foreignRetentionRate: 6.37,
        },
        {
          localDate: "20250820",
          closePrice: 40950.0,
          openPrice: 40300.0,
          highPrice: 41000.0,
          lowPrice: 40300.0,
          accumulatedTradingVolume: 35943,
          foreignRetentionRate: 6.4,
        },
        {
          localDate: "20250821",
          closePrice: 40950.0,
          openPrice: 40800.0,
          highPrice: 41450.0,
          lowPrice: 40600.0,
          accumulatedTradingVolume: 18171,
          foreignRetentionRate: 6.36,
        },
        {
          localDate: "20250822",
          closePrice: 41200.0,
          openPrice: 40700.0,
          highPrice: 41700.0,
          lowPrice: 40700.0,
          accumulatedTradingVolume: 24534,
          foreignRetentionRate: 6.35,
        },
        {
          localDate: "20250825",
          closePrice: 41550.0,
          openPrice: 41150.0,
          highPrice: 41750.0,
          lowPrice: 41000.0,
          accumulatedTradingVolume: 13009,
          foreignRetentionRate: 6.39,
        },
        {
          localDate: "20250826",
          closePrice: 41400.0,
          openPrice: 41550.0,
          highPrice: 41600.0,
          lowPrice: 39100.0,
          accumulatedTradingVolume: 23658,
          foreignRetentionRate: 6.41,
        },
        {
          localDate: "20250827",
          closePrice: 41400.0,
          openPrice: 41400.0,
          highPrice: 41800.0,
          lowPrice: 41100.0,
          accumulatedTradingVolume: 21636,
          foreignRetentionRate: 6.41,
        },
        {
          localDate: "20250828",
          closePrice: 41350.0,
          openPrice: 41150.0,
          highPrice: 41500.0,
          lowPrice: 41100.0,
          accumulatedTradingVolume: 23934,
          foreignRetentionRate: 6.44,
        },
        {
          localDate: "20250829",
          closePrice: 41150.0,
          openPrice: 41100.0,
          highPrice: 41450.0,
          lowPrice: 40950.0,
          accumulatedTradingVolume: 37064,
          foreignRetentionRate: 6.38,
        },
        {
          localDate: "20250901",
          closePrice: 40050.0,
          openPrice: 41000.0,
          highPrice: 41150.0,
          lowPrice: 39150.0,
          accumulatedTradingVolume: 98028,
          foreignRetentionRate: 6.17,
        },
        {
          localDate: "20250902",
          closePrice: 39950.0,
          openPrice: 40200.0,
          highPrice: 40400.0,
          lowPrice: 37150.0,
          accumulatedTradingVolume: 102839,
          foreignRetentionRate: 6.04,
        },
        {
          localDate: "20250903",
          closePrice: 38550.0,
          openPrice: 39150.0,
          highPrice: 39550.0,
          lowPrice: 38550.0,
          accumulatedTradingVolume: 82768,
          foreignRetentionRate: 6.08,
        },
        {
          localDate: "20250904",
          closePrice: 35650.0,
          openPrice: 38250.0,
          highPrice: 38250.0,
          lowPrice: 35450.0,
          accumulatedTradingVolume: 125176,
          foreignRetentionRate: 5.95,
        },
        {
          localDate: "20250905",
          closePrice: 34950.0,
          openPrice: 35750.0,
          highPrice: 35750.0,
          lowPrice: 34850.0,
          accumulatedTradingVolume: 34030,
          foreignRetentionRate: 5.95,
        },
      ];

      let charts = {};

      // ÎÇ†Ïßú ÌååÏã± Ìï®Ïàò
      function parseDate(dateStr) {
        const year = dateStr.substring(0, 4);
        const month = dateStr.substring(4, 6);
        const day = dateStr.substring(6, 8);
        return new Date(year, month - 1, day);
      }

      // Ïù¥ÎèôÌèâÍ∑†ÏÑ† Í≥ÑÏÇ∞ Ìï®Ïàò
      function calculateMovingAverage(data, period) {
        const result = [];
        for (let i = 0; i < data.length; i++) {
          if (i < period - 1) {
            result.push(null); // Îç∞Ïù¥ÌÑ∞Í∞Ä Î∂ÄÏ°±Ìïú Í≤ΩÏö∞ null
          } else {
            let sum = 0;
            for (let j = i - period + 1; j <= i; j++) {
              sum += data[j].closePrice;
            }
            result.push({
              x: parseDate(data[i].localDate),
              y: sum / period,
            });
          }
        }
        return result.filter((item) => item !== null); // null Í∞í Ï†úÍ±∞
      }

      // ÏùºÎ™©Í∑†ÌòïÌëú Í≥ÑÏÇ∞ Ìï®Ïàò
      function calculateIchimoku(data) {
        const result = {
          tenkanSen: [],
          kijunSen: [],
          chikouSpan: [],
          senkouSpanA: [],
          senkouSpanB: [],
          cloudTop: [],
          cloudBottom: [],
        };

        for (let i = 0; i < data.length; i++) {
          const date = parseDate(data[i].localDate);

          // Ï†ÑÌôòÏÑ† (Tenkan-sen): 9ÏùºÍ∞Ñ ÏµúÍ≥†Í∞ÄÏôÄ ÏµúÏ†ÄÍ∞ÄÏùò ÌèâÍ∑†
          if (i >= 8) {
            let high = Math.max(
              ...data.slice(i - 8, i + 1).map((d) => d.highPrice)
            );
            let low = Math.min(
              ...data.slice(i - 8, i + 1).map((d) => d.lowPrice)
            );
            result.tenkanSen.push({ x: date, y: (high + low) / 2 });
          } else {
            result.tenkanSen.push({ x: date, y: null });
          }

          // Í∏∞Ï§ÄÏÑ† (Kijun-sen): 26ÏùºÍ∞Ñ ÏµúÍ≥†Í∞ÄÏôÄ ÏµúÏ†ÄÍ∞ÄÏùò ÌèâÍ∑†
          if (i >= 25) {
            let high = Math.max(
              ...data.slice(i - 25, i + 1).map((d) => d.highPrice)
            );
            let low = Math.min(
              ...data.slice(i - 25, i + 1).map((d) => d.lowPrice)
            );
            result.kijunSen.push({ x: date, y: (high + low) / 2 });
          } else {
            result.kijunSen.push({ x: date, y: null });
          }

          // ÌõÑÌñâÏä§Ìå¨ (Chikou Span): 26Ïùº Ï†Ñ Ï¢ÖÍ∞Ä
          if (i >= 25) {
            result.chikouSpan.push({ x: date, y: data[i - 25].closePrice });
          } else {
            result.chikouSpan.push({ x: date, y: null });
          }

          // ÏÑ†ÌñâÏä§Ìå¨ A (Senkou Span A): (Ï†ÑÌôòÏÑ† + Í∏∞Ï§ÄÏÑ†) / 2Î•º 26Ïùº ÏïûÏúºÎ°ú
          if (i >= 25) {
            let tenkan = result.tenkanSen[i].y;
            let kijun = result.kijunSen[i].y;
            if (tenkan !== null && kijun !== null) {
              result.senkouSpanA.push({ x: date, y: (tenkan + kijun) / 2 });
            } else {
              result.senkouSpanA.push({ x: date, y: null });
            }
          } else {
            result.senkouSpanA.push({ x: date, y: null });
          }

          // ÏÑ†ÌñâÏä§Ìå¨ B (Senkou Span B): 52ÏùºÍ∞Ñ ÏµúÍ≥†Í∞ÄÏôÄ ÏµúÏ†ÄÍ∞Ä ÌèâÍ∑†ÏùÑ 26Ïùº ÏïûÏúºÎ°ú
          if (i >= 51) {
            let high = Math.max(
              ...data.slice(i - 51, i + 1).map((d) => d.highPrice)
            );
            let low = Math.min(
              ...data.slice(i - 51, i + 1).map((d) => d.lowPrice)
            );
            result.senkouSpanB.push({ x: date, y: (high + low) / 2 });
          } else {
            result.senkouSpanB.push({ x: date, y: null });
          }
        }

        // Íµ¨Î¶ÑÎåÄ (Cloud) ÏÉÅÎã®Í≥º ÌïòÎã® Í≥ÑÏÇ∞
        for (let i = 0; i < result.senkouSpanA.length; i++) {
          const spanA = result.senkouSpanA[i].y;
          const spanB = result.senkouSpanB[i].y;

          if (spanA !== null && spanB !== null) {
            result.cloudTop.push({
              x: result.senkouSpanA[i].x,
              y: Math.max(spanA, spanB),
            });
            result.cloudBottom.push({
              x: result.senkouSpanA[i].x,
              y: Math.min(spanA, spanB),
            });
          } else {
            result.cloudTop.push({
              x: result.senkouSpanA[i].x,
              y: null,
            });
            result.cloudBottom.push({
              x: result.senkouSpanA[i].x,
              y: null,
            });
          }
        }

        // null Í∞í Ï†úÍ±∞
        Object.keys(result).forEach((key) => {
          result[key] = result[key].filter((item) => item.y !== null);
        });

        return result;
      }

      // MACD Í≥ÑÏÇ∞ Ìï®Ïàò (ÌÇ§ÏõÄÏ¶ùÍ∂å Í∏∞Ï§Ä)
      function calculateMACD(data, short = 12, long = 26, signal = 9) {
        // EMA Í≥ÑÏÇ∞ Ìï®Ïàò
        function calculateEMA(values, period) {
          const ema = [];
          const multiplier = 2 / (period + 1);

          // Ï≤´ Î≤àÏß∏ EMAÎäî SMAÎ°ú ÏãúÏûë
          let sum = 0;
          for (let i = 0; i < period && i < values.length; i++) {
            sum += values[i];
          }
          ema[period - 1] = sum / period;

          // ÎÇòÎ®∏ÏßÄ EMA Í≥ÑÏÇ∞
          for (let i = period; i < values.length; i++) {
            ema[i] = values[i] * multiplier + ema[i - 1] * (1 - multiplier);
          }

          return ema;
        }

        const prices = data.map((d) => d.closePrice);

        // 12Ïùº EMAÏôÄ 26Ïùº EMA Í≥ÑÏÇ∞
        const ema12 = calculateEMA(prices, short);
        const ema26 = calculateEMA(prices, long);

        // MACD ÎùºÏù∏ Í≥ÑÏÇ∞ (EMA12 - EMA26)
        const macdLine = [];
        for (let i = long - 1; i < data.length; i++) {
          if (ema12[i] !== undefined && ema26[i] !== undefined) {
            macdLine.push(ema12[i] - ema26[i]);
          }
        }

        // Signal ÎùºÏù∏ Í≥ÑÏÇ∞ (MACDÏùò 9Ïùº EMA)
        const signalLine = calculateEMA(macdLine, signal);

        // Histogram Í≥ÑÏÇ∞ (MACD - Signal)
        const histogram = [];
        for (let i = 0; i < macdLine.length; i++) {
          if (signalLine[i] !== undefined) {
            histogram.push(macdLine[i] - signalLine[i]);
          }
        }

        // Í≤∞Í≥ºÎ•º Chart.js ÌòïÏãùÏúºÎ°ú Î≥ÄÌôò
        const result = {
          macd: [],
          signal: [],
          histogram: [],
        };

        // MACD Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏ ÏÉùÏÑ±
        for (let i = 0; i < macdLine.length; i++) {
          const dataIndex = i + long - 1;
          if (dataIndex < data.length) {
            const date = parseDate(data[dataIndex].localDate);

            result.macd.push({
              x: date,
              y: macdLine[i],
            });

            if (signalLine[i] !== undefined) {
              result.signal.push({
                x: date,
                y: signalLine[i],
              });

              result.histogram.push({
                x: date,
                y: histogram[i - signal + 1] || 0,
              });
            }
          }
        }

        return result;
      }

      // RCI Í≥ÑÏÇ∞ Ìï®Ïàò (ÌÇ§ÏõÄÏ¶ùÍ∂å Í∏∞Ï§Ä - ÏôÑÏ†Ñ Ïû¨Íµ¨ÌòÑ)
      function calculateRCI(data) {
        const prices = data.map((d) => d.closePrice);

        // ÌëúÏ§Ä RCI Í≥ÑÏÇ∞ Ìï®Ïàò (Spearman ÏàúÏúÑ ÏÉÅÍ¥ÄÍ≥ÑÏàò Í∏∞Î∞ò)
        function calculateStandardRCI(prices, period, currentIndex) {
          if (currentIndex < period - 1) return null;

          // Ìï¥Îãπ Í∏∞Í∞ÑÏùò Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ÏôÄ ÎÇ†Ïßú ÏàúÏúÑ Ï∂îÏ∂ú
          const periodPrices = [];
          for (let i = 0; i < period; i++) {
            periodPrices.push({
              price: prices[currentIndex - i],
              dateRank: i + 1, // 1Ïù¥ ÏµúÏã†, periodÍ∞Ä Í∞ÄÏû• Ïò§ÎûòÎêú Í≤É
            });
          }

          // Í∞ÄÍ≤© ÏàúÏúÑ Í≥ÑÏÇ∞ (ÌÅ∞ Í∞ÄÍ≤©Î∂ÄÌÑ∞ 1ÏúÑ)
          periodPrices.sort((a, b) => b.price - a.price);
          for (let i = 0; i < periodPrices.length; i++) {
            periodPrices[i].priceRank = i + 1;
          }

          // ÏõêÎûò ÏàúÏÑúÎ°ú Î≥µÏõê
          periodPrices.sort((a, b) => a.dateRank - b.dateRank);

          // Spearman ÏàúÏúÑ ÏÉÅÍ¥ÄÍ≥ÑÏàò Í≥ÑÏÇ∞
          let sumD2 = 0;
          for (let i = 0; i < period; i++) {
            const d = periodPrices[i].dateRank - periodPrices[i].priceRank;
            sumD2 += d * d;
          }

          const n = period;
          const rci = (1 - (6 * sumD2) / (n * (n * n - 1))) * 100;
          return rci;
        }

        // Í≤∞Í≥º Î∞∞Ïó¥ ÏÉùÏÑ±
        const result = {
          rci9: [],
          rci13: [],
          rci18: [],
          rci26: [],
        };

        // Í∞Å Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏Ïóê ÎåÄÌï¥ RCI Í≥ÑÏÇ∞
        for (let i = 0; i < data.length; i++) {
          const date = parseDate(data[i].localDate);

          const rci9 = calculateStandardRCI(prices, 9, i);
          const rci13 = calculateStandardRCI(prices, 13, i);
          const rci18 = calculateStandardRCI(prices, 18, i);
          const rci26 = calculateStandardRCI(prices, 26, i);

          if (rci9 !== null) {
            result.rci9.push({ x: date, y: rci9 });
          }
          if (rci13 !== null) {
            result.rci13.push({ x: date, y: rci13 });
          }
          if (rci18 !== null) {
            result.rci18.push({ x: date, y: rci18 });
          }
          if (rci26 !== null) {
            result.rci26.push({ x: date, y: rci26 });
          }
        }

        return result;
      }

      // ÌÜµÍ≥Ñ Ï¥àÍ∏∞Ìôî
      function initializeStats() {
        const latest = stockData[stockData.length - 1];
        const oldest = stockData[0];
        const prices = stockData.map((d) => d.closePrice);
        const volumes = stockData.map((d) => d.accumulatedTradingVolume);

        const maxPrice = Math.max(...prices);
        const minPrice = Math.min(...prices);
        const avgVolume = volumes.reduce((a, b) => a + b, 0) / volumes.length;
        const priceChange = latest.closePrice - oldest.closePrice;
        const priceChangePercent = (
          (priceChange / oldest.closePrice) *
          100
        ).toFixed(2);

        const statsHTML = `
                <div class="stat-card">
                    <div class="stat-label">ÌòÑÏû¨Í∞Ä</div>
                    <div class="stat-value" style="color: ${
                      latest.closePrice >= oldest.closePrice
                        ? "#27ae60"
                        : "#e74c3c"
                    }">
                        ${latest.closePrice.toLocaleString()}Ïõê
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Í∏∞Í∞Ñ Îì±ÎùΩÎ•†</div>
                    <div class="stat-value" style="color: ${
                      priceChange >= 0 ? "#27ae60" : "#e74c3c"
                    }">
                        ${priceChange >= 0 ? "+" : ""}${priceChangePercent}%
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÏµúÍ≥†Í∞Ä</div>
                    <div class="stat-value">${maxPrice.toLocaleString()}Ïõê</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÏµúÏ†ÄÍ∞Ä</div>
                    <div class="stat-value">${minPrice.toLocaleString()}Ïõê</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">ÌèâÍ∑† Í±∞ÎûòÎüâ</div>
                    <div class="stat-value">${Math.round(
                      avgVolume
                    ).toLocaleString()}Ï£º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú®</div>
                    <div class="stat-value">${
                      latest.foreignRetentionRate
                    }%</div>
                </div>
            `;

        document.getElementById("statsGrid").innerHTML = statsHTML;
      }

      // ÎπóÍ∏à Ìå®ÌÑ¥ ÏÉùÏÑ± Ìï®Ïàò
      function createHatchPattern(ctx, color, direction = "right") {
        const patternCanvas = document.createElement("canvas");
        const patternContext = patternCanvas.getContext("2d");

        patternCanvas.width = 10;
        patternCanvas.height = 10;

        patternContext.strokeStyle = color;
        patternContext.lineWidth = 1;
        patternContext.globalAlpha = 0.6;

        if (direction === "right") {
          // Ïö∞ÏÉÅÌñ• ÎπóÍ∏à (/)
          patternContext.beginPath();
          patternContext.moveTo(0, 10);
          patternContext.lineTo(10, 0);
          patternContext.stroke();

          patternContext.beginPath();
          patternContext.moveTo(-2, 12);
          patternContext.lineTo(8, 2);
          patternContext.stroke();

          patternContext.beginPath();
          patternContext.moveTo(2, -2);
          patternContext.lineTo(12, 8);
          patternContext.stroke();
        } else {
          // Ï¢åÏÉÅÌñ• ÎπóÍ∏à (\)
          patternContext.beginPath();
          patternContext.moveTo(0, 0);
          patternContext.lineTo(10, 10);
          patternContext.stroke();

          patternContext.beginPath();
          patternContext.moveTo(-2, -2);
          patternContext.lineTo(8, 8);
          patternContext.stroke();

          patternContext.beginPath();
          patternContext.moveTo(2, 2);
          patternContext.lineTo(12, 12);
          patternContext.stroke();
        }

        return ctx.createPattern(patternCanvas, "repeat");
      }

      // Ï£ºÍ∞Ä Ï∞®Ìä∏ ÏÉùÏÑ±
      function createPriceChart() {
        const ctx = document
          .getElementById("candlestickChart")
          .getContext("2d");

        // ÎπóÍ∏à Ìå®ÌÑ¥ ÏÉùÏÑ±
        const orangeHatchPattern = createHatchPattern(ctx, "#e67e22", "right");
        const skyBlueHatchPattern = createHatchPattern(ctx, "#3498db", "left");

        // Ïù¥ÎèôÌèâÍ∑†ÏÑ† Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
        const ma5 = calculateMovingAverage(stockData, 5);
        const ma20 = calculateMovingAverage(stockData, 20);
        const ma60 = calculateMovingAverage(stockData, 60);

        // ÏùºÎ™©Í∑†ÌòïÌëú Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
        const ichimoku = calculateIchimoku(stockData);

        charts.price = new Chart(ctx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "Ï¢ÖÍ∞Ä",
                data: stockData.map((item) => ({
                  x: parseDate(item.localDate),
                  y: item.closePrice,
                })),
                borderColor: "#2c3e50",
                backgroundColor: "rgba(44, 62, 80, 0.1)",
                fill: false,
                tension: 0.1,
                pointRadius: 2,
                pointHoverRadius: 5,
                borderWidth: 2,
                order: 1,
              },
              {
                label: "5Ïùº Ïù¥ÌèâÏÑ†",
                data: ma5,
                borderColor: "#e74c3c",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.3,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 2,
                order: 2,
              },
              {
                label: "20Ïùº Ïù¥ÌèâÏÑ†",
                data: ma20,
                borderColor: "#f39c12",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.3,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 2,
                order: 3,
              },
              {
                label: "60Ïùº Ïù¥ÌèâÏÑ†",
                data: ma60,
                borderColor: "#9b59b6",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.3,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 2,
                order: 4,
              },
              {
                label: "Í≥†Í∞Ä",
                data: stockData.map((item) => ({
                  x: parseDate(item.localDate),
                  y: item.highPrice,
                })),
                borderColor: "rgba(231, 76, 60, 0.5)",
                backgroundColor: "transparent",
                borderDash: [3, 3],
                pointRadius: 0,
                pointHoverRadius: 2,
                borderWidth: 1,
                order: 5,
              },
              {
                label: "Ï†ÄÍ∞Ä",
                data: stockData.map((item) => ({
                  x: parseDate(item.localDate),
                  y: item.lowPrice,
                })),
                borderColor: "rgba(39, 174, 96, 0.5)",
                backgroundColor: "transparent",
                borderDash: [3, 3],
                pointRadius: 0,
                pointHoverRadius: 2,
                borderWidth: 1,
                order: 6,
              },
              // ÏùºÎ™©Í∑†ÌòïÌëú Íµ¨ÏÑ±ÏöîÏÜåÎì§
              {
                label: "Ï†ÑÌôòÏÑ† (9Ïùº)",
                data: ichimoku.tenkanSen,
                borderColor: "#1abc9c",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.2,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 1.5,
                order: 7,
              },
              {
                label: "Í∏∞Ï§ÄÏÑ† (26Ïùº)",
                data: ichimoku.kijunSen,
                borderColor: "#e67e22",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.2,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 1.5,
                order: 8,
              },
              {
                label: "ÌõÑÌñâÏä§Ìå¨",
                data: ichimoku.chikouSpan,
                borderColor: "#8e44ad",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.2,
                pointRadius: 0,
                pointHoverRadius: 3,
                borderWidth: 1.5,
                borderDash: [2, 2],
                order: 9,
              },
              {
                label: "Íµ¨Î¶ÑÎåÄ ÏÉÅÎã®",
                data: ichimoku.cloudTop,
                borderColor: "rgba(230, 126, 34, 0.8)",
                backgroundColor: orangeHatchPattern,
                fill: "+1", // Îã§Ïùå datasetÍ≥º Ï±ÑÏö∞Í∏∞
                tension: 0.2,
                pointRadius: 0,
                pointHoverRadius: 0,
                borderWidth: 1,
                order: 10,
              },
              {
                label: "Íµ¨Î¶ÑÎåÄ ÌïòÎã®",
                data: ichimoku.cloudBottom,
                borderColor: "rgba(52, 152, 219, 0.8)",
                backgroundColor: skyBlueHatchPattern,
                fill: false,
                tension: 0.2,
                pointRadius: 0,
                pointHoverRadius: 0,
                borderWidth: 1,
                order: 11,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
              intersect: false,
              mode: "index",
            },
            scales: {
              x: {
                type: "time",
                time: {
                  displayFormats: {
                    day: "MM/dd",
                    week: "MM/dd",
                    month: "yy/MM",
                  },
                },
                title: {
                  display: true,
                  text: "ÎÇ†Ïßú",
                },
              },
              y: {
                title: {
                  display: true,
                  text: "Í∞ÄÍ≤© (Ïõê)",
                },
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString() + "Ïõê";
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return (
                      context.dataset.label +
                      ": " +
                      context.parsed.y.toLocaleString() +
                      "Ïõê"
                    );
                  },
                },
              },
            },
          },
        });
      }

      // Í±∞ÎûòÎüâ Ï∞®Ìä∏ ÏÉùÏÑ±
      function createVolumeChart() {
        const ctx = document
          .getElementById("volumeChartCanvas")
          .getContext("2d");

        charts.volume = new Chart(ctx, {
          type: "bar",
          data: {
            datasets: [
              {
                label: "Í±∞ÎûòÎüâ",
                data: stockData.map((item) => ({
                  x: parseDate(item.localDate),
                  y: item.accumulatedTradingVolume,
                })),
                backgroundColor: stockData.map((item, index) => {
                  if (index === 0) return "#3498db";
                  const prevClose = stockData[index - 1].closePrice;
                  return item.closePrice >= prevClose ? "#27ae60" : "#e74c3c";
                }),
                borderWidth: 0,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: "time",
                time: {
                  displayFormats: {
                    day: "MM/dd",
                    week: "MM/dd",
                    month: "yy/MM",
                  },
                },
                title: {
                  display: true,
                  text: "ÎÇ†Ïßú",
                },
              },
              y: {
                title: {
                  display: true,
                  text: "Í±∞ÎûòÎüâ (Ï£º)",
                },
                ticks: {
                  callback: function (value) {
                    return value.toLocaleString() + "Ï£º";
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return (
                      "Í±∞ÎûòÎüâ: " + context.parsed.y.toLocaleString() + "Ï£º"
                    );
                  },
                },
              },
            },
          },
        });
      }

      // MACD Ï∞®Ìä∏ ÏÉùÏÑ±
      function createMACDChart() {
        const ctx = document.getElementById("macdChartCanvas").getContext("2d");

        // MACD Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
        const macdData = calculateMACD(stockData);

        charts.macd = new Chart(ctx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "MACD",
                data: macdData.macd,
                borderColor: "#2980b9",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 1,
              },
              {
                label: "Signal",
                data: macdData.signal,
                borderColor: "#e74c3c",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 2,
              },
              {
                label: "Histogram",
                data: macdData.histogram,
                backgroundColor: macdData.histogram.map(
                  (point) =>
                    point.y >= 0
                      ? "rgba(255, 165, 0, 0.7)" // Ïò§Î†åÏßÄÏÉâ (ÏñëÏàò)
                      : "rgba(135, 206, 250, 0.7)" // ÌïòÎäòÏÉâ (ÏùåÏàò)
                ),
                borderColor: macdData.histogram.map(
                  (point) => (point.y >= 0 ? "#FF8C00" : "#87CEEB") // ÏßÑÌïú Ïò§Î†åÏßÄ, ÏßÑÌïú ÌïòÎäòÏÉâ
                ),
                borderWidth: 1,
                type: "bar",
                order: 3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: "time",
                time: {
                  displayFormats: {
                    day: "MM/dd",
                    week: "MM/dd",
                    month: "yy/MM",
                  },
                },
                title: {
                  display: true,
                  text: "ÎÇ†Ïßú",
                },
              },
              y: {
                title: {
                  display: true,
                  text: "MACD Í∞í",
                },
                grid: {
                  color: function (context) {
                    if (context.tick.value === 0) {
                      return "#666666";
                    }
                    return "rgba(200, 200, 200, 0.3)";
                  },
                  lineWidth: function (context) {
                    if (context.tick.value === 0) {
                      return 2;
                    }
                    return 1;
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.dataset.label;
                    const value = context.parsed.y.toFixed(4);
                    return `${label}: ${value}`;
                  },
                },
              },
            },
            interaction: {
              intersect: false,
              mode: "index",
            },
          },
        });
      }

      // RCI Ï∞®Ìä∏ ÏÉùÏÑ±
      function createRCIChart() {
        const ctx = document.getElementById("rciChartCanvas").getContext("2d");

        // RCI Îç∞Ïù¥ÌÑ∞ Í≥ÑÏÇ∞
        const rciData = calculateRCI(stockData);

        charts.rci = new Chart(ctx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "RCI9",
                data: rciData.rci9,
                borderColor: "#e74c3c",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 1,
              },
              {
                label: "RCI13",
                data: rciData.rci13,
                borderColor: "#f39c12",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 2,
              },
              {
                label: "RCI18",
                data: rciData.rci18,
                borderColor: "#3498db",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 3,
              },
              {
                label: "RCI26",
                data: rciData.rci26,
                borderColor: "#9b59b6",
                backgroundColor: "transparent",
                fill: false,
                tension: 0.1,
                pointRadius: 0,
                pointHoverRadius: 4,
                borderWidth: 2,
                order: 4,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: "time",
                time: {
                  displayFormats: {
                    day: "MM/dd",
                    week: "MM/dd",
                    month: "yy/MM",
                  },
                },
                title: {
                  display: true,
                  text: "ÎÇ†Ïßú",
                },
              },
              y: {
                min: -100,
                max: 100,
                title: {
                  display: true,
                  text: "RCI Í∞í (%)",
                },
                grid: {
                  color: function (context) {
                    if (context.tick.value === 0) {
                      return "#666666";
                    } else if (
                      context.tick.value === 80 ||
                      context.tick.value === -80
                    ) {
                      return "#d35400";
                    } else if (
                      context.tick.value === 50 ||
                      context.tick.value === -50
                    ) {
                      return "#e67e22";
                    }
                    return "rgba(200, 200, 200, 0.3)";
                  },
                  lineWidth: function (context) {
                    if (context.tick.value === 0) {
                      return 2;
                    } else if (
                      context.tick.value === 80 ||
                      context.tick.value === -80
                    ) {
                      return 1.5;
                    }
                    return 1;
                  },
                },
                ticks: {
                  stepSize: 20,
                },
              },
            },
            plugins: {
              legend: {
                display: true,
                position: "top",
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    const label = context.dataset.label;
                    const value = context.parsed.y.toFixed(2);
                    return `${label}: ${value}%`;
                  },
                },
              },
              annotation: {
                annotations: {
                  line80: {
                    type: "line",
                    yMin: 80,
                    yMax: 80,
                    borderColor: "#d35400",
                    borderWidth: 1,
                    borderDash: [5, 5],
                  },
                  lineMinus80: {
                    type: "line",
                    yMin: -80,
                    yMax: -80,
                    borderColor: "#d35400",
                    borderWidth: 1,
                    borderDash: [5, 5],
                  },
                  line50: {
                    type: "line",
                    yMin: 50,
                    yMax: 50,
                    borderColor: "#e67e22",
                    borderWidth: 1,
                    borderDash: [3, 3],
                  },
                  lineMinus50: {
                    type: "line",
                    yMin: -50,
                    yMax: -50,
                    borderColor: "#e67e22",
                    borderWidth: 1,
                    borderDash: [3, 3],
                  },
                },
              },
            },
            interaction: {
              intersect: false,
              mode: "index",
            },
          },
        });
      }

      // Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú® Ï∞®Ìä∏ ÏÉùÏÑ±
      function createForeignChart() {
        const ctx = document
          .getElementById("foreignChartCanvas")
          .getContext("2d");

        charts.foreign = new Chart(ctx, {
          type: "line",
          data: {
            datasets: [
              {
                label: "Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú®",
                data: stockData.map((item) => ({
                  x: parseDate(item.localDate),
                  y: item.foreignRetentionRate,
                })),
                borderColor: "#9b59b6",
                backgroundColor: "rgba(155, 89, 182, 0.1)",
                fill: true,
                tension: 0.4,
                pointRadius: 3,
                pointHoverRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              x: {
                type: "time",
                time: {
                  displayFormats: {
                    day: "MM/dd",
                    week: "MM/dd",
                    month: "yy/MM",
                  },
                },
                title: {
                  display: true,
                  text: "ÎÇ†Ïßú",
                },
              },
              y: {
                title: {
                  display: true,
                  text: "Î≥¥Ïú†Ïú® (%)",
                },
                ticks: {
                  callback: function (value) {
                    return value + "%";
                  },
                },
              },
            },
            plugins: {
              legend: {
                display: false,
              },
              tooltip: {
                callbacks: {
                  label: function (context) {
                    return "Ïô∏Íµ≠Ïù∏ Î≥¥Ïú†Ïú®: " + context.parsed.y + "%";
                  },
                },
              },
            },
          },
        });
      }

      // Ï∞®Ìä∏ ÌëúÏãú Ìï®Ïàò
      function showChart(type) {
        document
          .querySelectorAll(".btn")
          .forEach((btn) => btn.classList.remove("active"));
        event.target.classList.add("active");

        document.querySelectorAll(".chart-section").forEach((section) => {
          section.style.display = "none";
        });

        if (type === "price") {
          document.getElementById("priceChart").style.display = "block";
        } else if (type === "volume") {
          document.getElementById("volumeChart").style.display = "block";
        } else if (type === "macd") {
          document.getElementById("macdChart").style.display = "block";
        } else if (type === "rci") {
          document.getElementById("rciChart").style.display = "block";
        } else if (type === "foreign") {
          document.getElementById("foreignChart").style.display = "block";
        } else if (type === "all") {
          document.querySelectorAll(".chart-section").forEach((section) => {
            if (section.id !== "aiAnalysisSection") {
              section.style.display = "block";
            }
          });
        }

        setTimeout(() => {
          Object.values(charts).forEach((chart) => {
            if (chart) chart.resize();
          });
        }, 100);
      }

      // AI Î∂ÑÏÑù Ìï®ÏàòÎì§
      function showAIAnalysis() {
        console.log("ü§ñ AI Î∂ÑÏÑù ÏãúÏûë");

        // Î™®Îì† Ï∞®Ìä∏ Ïà®Í∏∞Í∏∞
        document.querySelectorAll(".chart-section").forEach((section) => {
          section.style.display = "none";
        });

        // AI Î∂ÑÏÑù ÏÑπÏÖò Î≥¥Ïù¥Í∏∞
        document.getElementById("aiAnalysisSection").style.display = "block";

        // Î≤ÑÌäº ÏÉÅÌÉú ÏóÖÎç∞Ïù¥Ìä∏
        document
          .querySelectorAll(".btn")
          .forEach((btn) => btn.classList.remove("active"));
        document.querySelector(".ai-analysis-btn").classList.add("active");

        // Î∂ÑÏÑù Ïã§Ìñâ
        performAIAnalysis();
      }

      async function performAIAnalysis() {
        const loadingEl = document.getElementById("analysisLoading");
        const contentEl = document.getElementById("analysisContent");

        loadingEl.style.display = "block";
        contentEl.style.display = "none";

        try {
          // 1. Í∏∞Ïà†Ï†Å Î∂ÑÏÑù ÏàòÌñâ
          const technicalAnalysis = performTechnicalAnalysis();

          // 2. ÌÇ§ÏõåÎìú Î∂ÑÏÑù Ï§ÄÎπÑ
          await new Promise((resolve) => setTimeout(resolve, 2000)); // Î°úÎî© ÏãúÎÆ¨Î†àÏù¥ÏÖò

          // 3. Ï¢ÖÌï© Î∂ÑÏÑù ÏÉùÏÑ± (Îâ¥Ïä§ Îç∞Ïù¥ÌÑ∞ ÏóÜÏù¥)
          const aiAnalysis = generateAIAnalysis(technicalAnalysis);

          // 4. Í≤∞Í≥º ÌëúÏãú
          displayAnalysisResults(technicalAnalysis, aiAnalysis);

          loadingEl.style.display = "none";
          contentEl.style.display = "block";
        } catch (error) {
          console.error("Î∂ÑÏÑù Ï§ë Ïò§Î•ò:", error);
          contentEl.innerHTML = `
            <div class="analysis-section">
              <h3>‚ö†Ô∏è Î∂ÑÏÑù Ïò§Î•ò</h3>
              <p>Î∂ÑÏÑù Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§. Ïû†Ïãú ÌõÑ Îã§Ïãú ÏãúÎèÑÌï¥Ï£ºÏÑ∏Ïöî.</p>
            </div>
          `;
          loadingEl.style.display = "none";
          contentEl.style.display = "block";
        }
      }

      function performTechnicalAnalysis() {
        const latestData = stockData[stockData.length - 1];
        const prevData = stockData[stockData.length - 2];
        const weekAgoData = stockData[Math.max(0, stockData.length - 5)];

        // ÌòÑÏû¨ Í∞ÄÍ≤©Í≥º Ïù¥ÎèôÌèâÍ∑† ÎπÑÍµê
        const currentPrice = latestData.closePrice;
        const ma5 = calculateSimpleMA(5);
        const ma20 = calculateSimpleMA(20);
        const ma60 = calculateSimpleMA(60);

        // MACD Ïã†Ìò∏
        const macdData = calculateMACD(stockData);
        const latestMACD = macdData.macd[macdData.macd.length - 1];
        const latestSignal = macdData.signal[macdData.signal.length - 1];
        const latestHistogram =
          macdData.histogram[macdData.histogram.length - 1];

        // RCI Ïã†Ìò∏
        const rciData = calculateRCI(stockData);
        const latestRCI9 = rciData.rci9[rciData.rci9.length - 1];
        const latestRCI26 = rciData.rci26[rciData.rci26.length - 1];

        // Í±∞ÎûòÎüâ Î∂ÑÏÑù
        const avgVolume =
          stockData
            .slice(-10)
            .reduce((sum, d) => sum + d.accumulatedTradingVolume, 0) / 10;
        const currentVolume = latestData.accumulatedTradingVolume;

        // Í∞ÄÍ≤© Î≥ÄÎèôÎ•†
        const priceChangePercent =
          ((currentPrice - prevData.closePrice) / prevData.closePrice) * 100;
        const weekChangePercent =
          ((currentPrice - weekAgoData.closePrice) / weekAgoData.closePrice) *
          100;

        return {
          currentPrice,
          priceChangePercent,
          weekChangePercent,
          ma5: ma5.toFixed(0),
          ma20: ma20.toFixed(0),
          ma60: ma60.toFixed(0),
          macdSignal: latestMACD?.y > latestSignal?.y ? "ÏÉÅÏäπ" : "ÌïòÎùΩ",
          macdValue: latestMACD?.y?.toFixed(2) || "N/A",
          rci9: latestRCI9?.y?.toFixed(1) || "N/A",
          rci26: latestRCI26?.y?.toFixed(1) || "N/A",
          volumeRatio: (currentVolume / avgVolume).toFixed(2),
          trend:
            currentPrice > ma20
              ? currentPrice > ma60
                ? "Í∞ïÌïúÏÉÅÏäπ"
                : "ÏÉÅÏäπ"
              : currentPrice < ma60
              ? "Í∞ïÌïúÌïòÎùΩ"
              : "ÌïòÎùΩ",
          support: Math.min(ma20, ma60).toFixed(0),
          resistance: Math.max(ma20, ma60).toFixed(0),
        };
      }

      function calculateSimpleMA(period) {
        const prices = stockData.slice(-period).map((d) => d.closePrice);
        return prices.reduce((sum, price) => sum + price, 0) / prices.length;
      }

      async function getNaverFinanceNews() {
        // ÎÑ§Ïù¥Î≤Ñ Í∏àÏúµ(finance.naver.com) DIÎèôÏùº Îâ¥Ïä§ ÏãúÎÆ¨Î†àÏù¥ÏÖò
        // Ïã§Ï†ú ÏÑ¨Ïú† Î∞è 2Ï∞®Ï†ÑÏßÄ ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏÇ¨ÏóÖ Í¥ÄÎ†® Îâ¥Ïä§
        return [
          {
            title:
              "DIÎèôÏùº, 2Ï∞®Ï†ÑÏßÄÏö© ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏàòÏ£º ÌôïÎåÄ...Ï†ÑÍ∏∞Ï∞® ÏàòÏöî Í∏âÏ¶ù ÏàòÌòú",
            summary:
              "DIÎèôÏùºÏù¥ 2Ï∞®Ï†ÑÏßÄÏö© ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏÉùÏÇ∞ Îä•Î†•ÏùÑ ÌôïÎåÄÌïòÎ©∞ Íµ≠ÎÇ¥Ïô∏ Ï†ÑÍ∏∞Ï∞® Î∞∞ÌÑ∞Î¶¨ ÏóÖÏ≤¥Îì§Î°úÎ∂ÄÌÑ∞ ÎåÄÍ∑úÎ™® ÏàòÏ£ºÎ•º ÌôïÎ≥¥ÌñàÏäµÎãàÎã§. Ï†ÑÍ∏∞Ï∞® ÏãúÏû• ÏÑ±Ïû•Í≥º Ìï®Íªò 2Ï∞®Ï†ÑÏßÄ ÏÜåÏû¨ ÏàòÏöîÍ∞Ä Í∏âÏ¶ùÌïòÎ©¥ÏÑú Ïã§Ï†Å Í∞úÏÑ†Ïù¥ Í∏∞ÎåÄÎêúÎã§Í≥† Î∂ÑÏÑùÎê©ÎãàÎã§.",
            date: "2025-09-05",
            sentiment: "positive",
            source: "Ïù¥Îç∞ÏùºÎ¶¨",
            url: "https://finance.naver.com/item/news_read.naver?article_id=0005831234&office_id=018&code=001530",
            keywords: ["2Ï∞®Ï†ÑÏßÄ", "ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï", "Ï†ÑÍ∏∞Ï∞®", "Î∞∞ÌÑ∞Î¶¨", "ÏàòÏ£º"],
          },
          {
            title: "DIÎèôÏùº, ÏπúÌôòÍ≤Ω ÏÑ¨Ïú†ÏÜåÏû¨ Í∞úÎ∞ú...ÏßÄÏÜçÍ∞ÄÎä• Ìå®ÏÖò Ìä∏Î†åÎìú ÎåÄÏùë",
            summary:
              "DIÎèôÏùºÏù¥ Ïû¨ÌôúÏö© Ìè¥Î¶¨ÏóêÏä§ÌÑ∞ÏôÄ Î∞îÏù¥Ïò§ Í∏∞Î∞ò ÏÑ¨Ïú†ÏÜåÏû¨ Í∞úÎ∞úÏóê ÏßëÏ§ëÌïòÍ≥† ÏûàÏäµÎãàÎã§. Í∏ÄÎ°úÎ≤å Ìå®ÏÖòÏóÖÍ≥ÑÏùò ÏßÄÏÜçÍ∞ÄÎä•ÏÑ± ÏöîÍµ¨Í∞Ä ÎÜíÏïÑÏßÄÎ©¥ÏÑú ÏπúÌôòÍ≤Ω ÏÑ¨Ïú† ÏãúÏû•ÏóêÏÑúÏùò Í≤ΩÏüÅÎ†• Í∞ïÌôîÎ•º ÏúÑÌïú Ìà¨ÏûêÎ•º ÌôïÎåÄÌïòÍ≥† ÏûàÎã§Í≥† Î∞ùÌòîÏäµÎãàÎã§.",
            date: "2025-09-04",
            sentiment: "positive",
            source: "ÏÑ¨Ïú†Ïã†Î¨∏",
            url: "https://finance.naver.com/item/news_read.naver?article_id=0001234567&office_id=123&code=001530",
            keywords: [
              "ÏπúÌôòÍ≤Ω",
              "ÏÑ¨Ïú†ÏÜåÏû¨",
              "Ïû¨ÌôúÏö©",
              "ÏßÄÏÜçÍ∞ÄÎä•",
              "Ìè¥Î¶¨ÏóêÏä§ÌÑ∞",
            ],
          },
          {
            title: "DIÎèôÏùº, 3Î∂ÑÍ∏∞ Ïã§Ï†Å Í∞úÏÑ† Ï†ÑÎßù...ÏÑ¨Ïú† Î∞è Ï†ÑÏßÄÏÜåÏû¨ Î∂ÄÎ¨∏ Ìò∏Ï°∞",
            summary:
              "DIÎèôÏùºÏù¥ 3Î∂ÑÍ∏∞ Ïó∞Í≤∞Í∏∞Ï§Ä Îß§Ï∂úÏï°Ïù¥ Ï†ÑÎÖÑ ÎèôÍ∏∞ ÎåÄÎπÑ 12% Ï¶ùÍ∞ÄÌï† Í≤ÉÏúºÎ°ú Ï†ÑÎßùÎêúÎã§Í≥† Î∞úÌëúÌñàÏäµÎãàÎã§. Ï£ºÎ†• ÏÑ¨Ïú†ÏÇ¨ÏóÖÏùò ÏïàÏ†ïÏ†Å ÏàòÏùµÍ≥º 2Ï∞®Ï†ÑÏßÄÏö© ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï Î∂ÄÎ¨∏Ïùò ÏÑ±Ïû•Ïù¥ Ïã§Ï†Å Í∞úÏÑ†ÏùÑ Ïù¥ÎÅåÍ≥† ÏûàÎã§Í≥† Î∂ÑÏÑùÎê©ÎãàÎã§.",
            date: "2025-09-03",
            sentiment: "positive",
            source: "Î®∏ÎãàÌà¨Îç∞Ïù¥",
            url: "https://finance.naver.com/item/news_read.naver?article_id=0002345678&office_id=008&code=001530",
            keywords: ["Ïã§Ï†Å", "ÏÑ¨Ïú†ÏÇ¨ÏóÖ", "Ï†ÑÏßÄÏÜåÏû¨", "Îß§Ï∂ú", "ÏÑ±Ïû•"],
          },
          {
            title: "ÏõêÏûêÏû¨ Í∞ÄÍ≤© ÏÉÅÏäπÏúºÎ°ú DIÎèôÏùº Îì± ÏÑ¨Ïú†ÏóÖÏ≤¥ ÏàòÏùµÏÑ± ÏïïÎ∞ï",
            summary:
              "Î©¥Ìôî, Ìè¥Î¶¨ÏóêÏä§ÌÑ∞ ÏõêÎ£å Îì± Ï£ºÏöî ÏÑ¨Ïú† ÏõêÏûêÏû¨ Í∞ÄÍ≤©Ïù¥ ÏÉÅÏäπÌïòÎ©¥ÏÑú DIÎèôÏùºÏùÑ ÎπÑÎ°ØÌïú Íµ≠ÎÇ¥ ÏÑ¨Ïú†ÏóÖÏ≤¥Îì§Ïù¥ ÏàòÏùµÏÑ± ÏïÖÌôî Ïö∞Î†§Ïóê ÏßÅÎ©¥ÌñàÏäµÎãàÎã§. ÏóÖÍ≥ÑÏóêÏÑúÎäî Ï†úÌíà Í∞ÄÍ≤© Ïù∏ÏÉÅÍ≥º ÏõêÍ∞Ä Ï†àÍ∞êÏùÑ ÌÜµÌïú ÎåÄÏùëÏù¥ ÌïÑÏöîÌïòÎã§Í≥† ÏßÄÏ†ÅÌï©ÎãàÎã§.",
            date: "2025-09-02",
            sentiment: "negative",
            source: "ÌïúÍµ≠ÏÑ¨Ïú†Ïã†Î¨∏",
            url: "https://finance.naver.com/item/news_read.naver?article_id=0003456789&office_id=456&code=001530",
            keywords: ["ÏõêÏûêÏû¨", "Î©¥Ìôî", "Ìè¥Î¶¨ÏóêÏä§ÌÑ∞", "ÏàòÏùµÏÑ±", "Í∞ÄÍ≤©ÏÉÅÏäπ"],
          },
          {
            title: "DIÎèôÏùº, Ï†ÑÏßÄÏÜåÏû¨ R&DÏÑºÌÑ∞ Ïã†ÏÑ§...Ï∞®ÏÑ∏ÎåÄ Î∞∞ÌÑ∞Î¶¨ Í∏∞Ïà† Í∞úÎ∞ú",
            summary:
              "DIÎèôÏùºÏù¥ Ï†ÑÏßÄÏÜåÏû¨ Ï†ÑÏö© R&DÏÑºÌÑ∞Î•º Ïã†ÏÑ§ÌïòÍ≥† Ï∞®ÏÑ∏ÎåÄ Î∞∞ÌÑ∞Î¶¨Ïö© Í≥†ÏÑ±Îä• ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï Í∞úÎ∞úÏóê ÎÇòÏÑ†Îã§Í≥† Î∞úÌëúÌñàÏäµÎãàÎã§. Ï†ÑÍ≥†Ï≤¥ Î∞∞ÌÑ∞Î¶¨ÏôÄ Ï∞®ÏÑ∏ÎåÄ Î¶¨Ìä¨Ïù¥Ïò®Î∞∞ÌÑ∞Î¶¨Ïö© ÏÜåÏû¨ Í∞úÎ∞úÏùÑ ÌÜµÌï¥ ÎØ∏Îûò Ï†ÑÏßÄÏãúÏû• ÏÑ†Ï†êÏùÑ Î™©ÌëúÎ°ú ÌïòÍ≥† ÏûàÏäµÎãàÎã§.",
            date: "2025-09-01",
            sentiment: "positive",
            source: "Ï†ÑÏûêÏã†Î¨∏",
            url: "https://finance.naver.com/item/news_read.naver?article_id=0004567890&office_id=030&code=001530",
            keywords: [
              "R&DÏÑºÌÑ∞",
              "Ï†ÑÏßÄÏÜåÏû¨",
              "Ï∞®ÏÑ∏ÎåÄÎ∞∞ÌÑ∞Î¶¨",
              "Ï†ÑÍ≥†Ï≤¥",
              "Î¶¨Ìä¨Ïù¥Ïò®",
            ],
          },
        ];
      }

      function generateAIAnalysis(technical) {
        let overallSignal = "Î≥¥Ìï©";
        let confidence = 0;

        // Í∏∞Ïà†Ï†Å Î∂ÑÏÑù Ï†êÏàò
        let techScore = 0;
        if (technical.trend === "Í∞ïÌïúÏÉÅÏäπ") techScore += 3;
        else if (technical.trend === "ÏÉÅÏäπ") techScore += 1;
        else if (technical.trend === "ÌïòÎùΩ") techScore -= 1;
        else if (technical.trend === "Í∞ïÌïúÌïòÎùΩ") techScore -= 3;

        if (technical.macdSignal === "ÏÉÅÏäπ") techScore += 1;
        else techScore -= 1;

        if (parseFloat(technical.rci9) > 80) techScore -= 1;
        else if (parseFloat(technical.rci9) < -80) techScore += 1;

        if (parseFloat(technical.volumeRatio) > 1.5) techScore += 1;

        const totalScore = techScore;

        if (totalScore >= 3) {
          overallSignal = "Îß§Ïàò";
          confidence = Math.min(90, 60 + totalScore * 5);
        } else if (totalScore <= -3) {
          overallSignal = "Îß§ÎèÑ";
          confidence = Math.min(90, 60 + Math.abs(totalScore) * 5);
        } else if (totalScore >= 1) {
          overallSignal = "ÏïΩÌïúÎß§Ïàò";
          confidence = 50 + totalScore * 5;
        } else if (totalScore <= -1) {
          overallSignal = "ÏïΩÌïúÎß§ÎèÑ";
          confidence = 50 + Math.abs(totalScore) * 5;
        } else {
          overallSignal = "Î≥¥Ìï©";
          confidence = 45;
        }

        // GPT Ïä§ÌÉÄÏùº Ï¢ÖÌï© ÏÑúÏà† ÏÉùÏÑ±
        const aiCommentary = generateAICommentary(
          technical,
          overallSignal,
          confidence
        );

        return {
          signal: overallSignal,
          confidence: confidence,
          targetPrice: calculateTargetPrice(technical, overallSignal),
          timeHorizon: "1-2Ï£º",
          riskLevel: totalScore > 2 || totalScore < -2 ? "Ï§ëÍ∞Ñ" : "ÎÇÆÏùå",
          commentary: aiCommentary,
        };
      }

      function generateAICommentary(technical, signal, confidence) {
        // Í∏∞Ïà†Ï†Å ÏÉÅÌô© Î∂ÑÏÑù
        const trendAnalysis =
          technical.trend === "Í∞ïÌïúÏÉÅÏäπ"
            ? "Í∞ïÎ†•Ìïú ÏÉÅÏäπ Î™®Î©òÌÖÄ"
            : technical.trend === "ÏÉÅÏäπ"
            ? "Í∏çÏ†ïÏ†Å ÏÉÅÏäπ Ï∂îÏÑ∏"
            : technical.trend === "ÌïòÎùΩ"
            ? "Ï°∞Ï†ï Íµ≠Î©¥"
            : "Ìö°Î≥¥ Ìå®ÌÑ¥";

        const macdAnalysis =
          technical.macdSignal === "ÏÉÅÏäπ" ? "ÏÉÅÏäπ ÎèôÎ†• ÌôïÏù∏" : "ÌïòÎùΩ ÏïïÎ†• ÏßÄÏÜç";

        // Ï¢ÖÌï© ÏÑúÏà†Î¨∏ ÏÉùÏÑ±
        let commentary = `**DIÎèôÏùº(001530) Ï¢ÖÌï© Ìà¨ÏûêÎ∂ÑÏÑù**\n\n`;

        // 1. ÏÇ¨ÏóÖ ÌòÑÌô© Î∂ÑÏÑù
        commentary += `**üè≠ ÏÇ¨ÏóÖ ÌòÑÌô©:** DIÎèôÏùºÏùÄ 1955ÎÖÑ ÏÑ§Î¶ΩÎêú ÏÑ¨Ïú† Ï†ÑÎ¨∏ Í∏∞ÏóÖÏúºÎ°ú, ÏµúÍ∑º 2Ï∞®Ï†ÑÏßÄÏö© ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏÇ¨ÏóÖÏùÑ Ïã†ÏÑ±Ïû•ÎèôÎ†•ÏúºÎ°ú Ïú°ÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§. `;
        commentary += `Ï†ÑÍ∏∞Ï∞® ÏãúÏû• Í∏âÏÑ±Ïû•Í≥º Ìï®Íªò 2Ï∞®Ï†ÑÏßÄ ÏÜåÏû¨ ÏàòÏöîÍ∞Ä ÌÅ¨Í≤å Ï¶ùÍ∞ÄÌïòÎ©¥ÏÑú ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï Î∂ÄÎ¨∏Ïùò ÏÑ±Ïû•Ïù¥ Ï£ºÎ™©Î∞õÍ≥† ÏûàÏúºÎ©∞, `;
        commentary += `ÎèôÏãúÏóê ÏÜåÏï°Ï£ºÏ£º Î∞è Í≤ΩÏòÅÍ∂å Í¥ÄÎ†® Ïù¥ÏäàÍ∞Ä ÏãúÏû•Ïùò Í¥ÄÏã¨ÏùÑ Î∞õÍ≥† ÏûàÏñ¥ Ï£ºÍ∞Ä Î≥ÄÎèôÏÑ±Ïù¥ ÌôïÎåÄÎêòÍ≥† ÏûàÏäµÎãàÎã§.\n\n`;

        // 2. Í∏∞Ïà†Ï†Å Î∂ÑÏÑù
        commentary += `**üìä Í∏∞Ïà†Ï†Å Î∂ÑÏÑù:** ÌòÑÏû¨ Ï£ºÍ∞ÄÎäî ${technical.currentPrice.toLocaleString()}ÏõêÏúºÎ°ú ${trendAnalysis}ÏùÑ Î≥¥Ïù¥Í≥† ÏûàÏäµÎãàÎã§. `;
        commentary += `MACD ÏßÄÌëúÎäî ${macdAnalysis}ÎêòÍ≥† ÏûàÏúºÎ©∞, `;

        if (technical.currentPrice > parseFloat(technical.ma20)) {
          commentary += `20Ïùº Ïù¥ÎèôÌèâÍ∑†ÏÑ†(${technical.ma20}Ïõê) ÏÉÅÎã®ÏóêÏÑú Í±∞ÎûòÎêòÍ≥† ÏûàÏñ¥ Îã®Í∏∞ Í∞ïÏÑ∏Í∞Ä ÏßÄÏÜçÎêòÍ≥† ÏûàÏäµÎãàÎã§. `;
        } else {
          commentary += `20Ïùº Ïù¥ÎèôÌèâÍ∑†ÏÑ†(${technical.ma20}Ïõê) ÌïòÎã®ÏóêÏÑú Í±∞ÎûòÎêòÏñ¥ Îã®Í∏∞ Ï°∞Ï†ïÏù¥ ÏßÑÌñâ Ï§ëÏûÖÎãàÎã§. `;
        }

        if (parseFloat(technical.volumeRatio) > 1.5) {
          commentary += `Í±∞ÎûòÎüâÏùÄ ÌèâÍ∑† ÎåÄÎπÑ ${technical.volumeRatio}Î∞∞ Ï¶ùÍ∞ÄÌïòÏó¨ ÏãúÏû•Ïùò Í¥ÄÏã¨Ïù¥ ÎÜíÏïÑÏßÄÍ≥† ÏûàÏäµÎãàÎã§.\n\n`;
        } else {
          commentary += `Í±∞ÎûòÎüâÏùÄ ÌèâÍ∑† ÏàòÏ§ÄÏùÑ Ïú†ÏßÄÌïòÍ≥† ÏûàÏäµÎãàÎã§.\n\n`;
        }

        // 3. ÏãúÏû• Ïù¥Ïäà Î∂ÑÏÑù
        commentary += `**üì∞ ÏãúÏû• Ïù¥Ïäà:** ÏµúÍ∑º ÏÜåÏï°Ï£ºÏ£º Í∂åÏùµ Î≥¥Ìò∏ Î∞è Í≤ΩÏòÅÍ∂å Í¥ÄÎ†® Ïù¥ÏäàÍ∞Ä Î∂ÄÍ∞ÅÎêòÎ©¥ÏÑú Ï£ºÏ£ºÏ¥ùÌöåÏôÄ Ìï©Î≥ë Í¥ÄÎ†® ÎÖºÏùòÍ∞Ä ÌôúÎ∞úÌï¥ÏßÄÍ≥† ÏûàÏäµÎãàÎã§. `;
        commentary += `Ïù¥Îü¨Ìïú Í±∞Î≤ÑÎÑåÏä§ Ïù¥ÏäàÎäî Îã®Í∏∞Ï†ÅÏúºÎ°ú Ï£ºÍ∞Ä Î≥ÄÎèôÏÑ±ÏùÑ ÌôïÎåÄÏãúÌÇ¨ Ïàò ÏûàÏúºÎÇò, Ï§ëÏû•Í∏∞Ï†ÅÏúºÎ°úÎäî Í∏∞ÏóÖ Í∞ÄÏπò Ï†úÍ≥†Ïóê Í∏çÏ†ïÏ†Å ÏòÅÌñ•ÏùÑ ÎØ∏Ïπ† Í≤ÉÏúºÎ°ú Ï†ÑÎßùÎê©ÎãàÎã§. `;
        commentary += `ÎòêÌïú 2Ï∞®Ï†ÑÏßÄ ÏãúÏû•Ïùò ÏßÄÏÜçÏ†Å ÏÑ±Ïû•Í≥º Ìï®Íªò ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏÇ¨ÏóÖÏùò ÏÑ±Ïû• Ïû†Ïû¨Î†•Ïù¥ Ï£ºÎ™©Î∞õÍ≥† ÏûàÏäµÎãàÎã§.\n\n`;

        // 4. Ìà¨Ïûê ÏùòÍ≤¨
        commentary += `**üéØ Ìà¨Ïûê ÏùòÍ≤¨:** `;
        if (signal.includes("Îß§Ïàò")) {
          commentary += `DIÎèôÏùºÏùÄ Ï†ÑÌÜµÏ†ÅÏù∏ ÏÑ¨Ïú†ÏóÖÏ≤¥ÏóêÏÑú 2Ï∞®Ï†ÑÏßÄ ÏÜåÏû¨ Í∏∞ÏóÖÏúºÎ°ú ÏÑ±Í≥µÏ†ÅÏù∏ ÏÇ¨ÏóÖ Ï†ÑÌôòÏùÑ Ïù¥Î£®Í≥† ÏûàÏñ¥ **${signal}** ÏùòÍ≤¨ÏùÑ Ï†úÏãúÌï©ÎãàÎã§. `;
          commentary += `Ï†ÑÍ∏∞Ï∞® ÏãúÏû•Ïùò ÏßÄÏÜçÏ†Å ÏÑ±Ïû•Í≥º Ìï®Íªò 2Ï∞®Ï†ÑÏßÄÏö© ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï ÏàòÏöî Ï¶ùÍ∞ÄÍ∞Ä ÏòàÏÉÅÎêòÏñ¥ Ï§ëÏû•Í∏∞Ï†ÅÏúºÎ°ú Í∏çÏ†ïÏ†Å Ï†ÑÎßùÏùÑ Ïú†ÏßÄÌï©ÎãàÎã§. `;
        } else if (signal.includes("Îß§ÎèÑ")) {
          commentary += `Îã®Í∏∞Ï†ÅÏúºÎ°ú Í∏∞Ïà†Ï†Å Ï°∞Ï†ïÍ≥º Ïô∏Î∂Ä Î¶¨Ïä§ÌÅ¨ ÏöîÏù∏ÏúºÎ°ú Ïù∏Ìï¥ **${signal}** ÏùòÍ≤¨ÏùÑ Ï†úÏãúÌï©ÎãàÎã§. `;
          commentary += `Îã§Îßå ÌöåÏÇ¨Ïùò ÌéÄÎçîÎ©òÌÑ∏Í≥º ÏÇ¨ÏóÖ Ï†ÑÌôò ÎÖ∏Î†•ÏùÑ Í≥†Î†§Ìï† Îïå Ï§ëÏû•Í∏∞ Í¥ÄÏ†êÏóêÏÑúÎäî Ïû¨ÌèâÍ∞Ä Í∏∞ÌöåÍ∞Ä ÏûàÏùÑ Í≤ÉÏúºÎ°ú ÌåêÎã®Îê©ÎãàÎã§. `;
        } else {
          commentary += `ÌòÑÏû¨ Í∏∞Ïà†Ï†Å ÏßÄÌëúÏôÄ Îâ¥Ïä§ Ìå©ÌÑ∞Î•º Ï¢ÖÌï©Ìï† Îïå **${signal}** ÏùòÍ≤¨ÏùÑ Ï†úÏãúÌï©ÎãàÎã§. `;
          commentary += `Ï∂îÍ∞ÄÏ†ÅÏù∏ ÏÇ¨ÏóÖ ÏÑ±Í≥º Î∞úÌëúÏôÄ ÏãúÏû• ÏÉÅÌô©ÏùÑ ÏßÄÏºúÎ≥∏ ÌõÑ Ìà¨Ïûê ÏãúÏ†êÏùÑ Í≤∞Ï†ïÌïòÎäî Í≤ÉÏù¥ Î∞îÎûåÏßÅÌï† Í≤ÉÏúºÎ°ú ÌåêÎã®Îê©ÎãàÎã§. `;
        }

        commentary += `\n\n**üí° ÌïµÏã¨ Ìè¨Ïù∏Ìä∏:** 2Ï∞®Ï†ÑÏßÄ ÏÜåÏû¨ ÏÇ¨ÏóÖ ÏÑ±Ïû•ÏÑ±, ÏÑ¨Ïú†ÏÇ¨ÏóÖ ÏïàÏ†ïÏÑ±, Í∏∞Ïà†Ï†Å ${trendAnalysis} (Ïã†Î¢∞ÎèÑ: ${confidence}%)`;

        return commentary;
      }

      function calculateTargetPrice(technical, signal) {
        const currentPrice = technical.currentPrice;
        const ma20 = parseFloat(technical.ma20);
        const ma60 = parseFloat(technical.ma60);

        if (signal === "Îß§Ïàò") {
          return Math.round(currentPrice * 1.08); // 8% ÏÉÅÏäπ Î™©Ìëú
        } else if (signal === "Îß§ÎèÑ") {
          return Math.round(currentPrice * 0.92); // 8% ÌïòÎùΩ Î™©Ìëú
        } else if (signal === "ÏïΩÌïúÎß§Ïàò") {
          return Math.round(currentPrice * 1.04); // 4% ÏÉÅÏäπ Î™©Ìëú
        } else if (signal === "ÏïΩÌïúÎß§ÎèÑ") {
          return Math.round(currentPrice * 0.96); // 4% ÌïòÎùΩ Î™©Ìëú
        } else {
          return Math.round((ma20 + ma60) / 2); // Ïù¥ÎèôÌèâÍ∑† Ï§ëÍ∞ÑÍ∞í
        }
      }

      function generateWordCloud() {
        // DIÎèôÏùº Í¥ÄÎ†® ÏµúÏã† ÌïµÏã¨ ÌÇ§ÏõåÎìú (ÏÜåÏï°Ï£ºÏ£º, Ìï©Î≥ë Ïù¥Ïäà Î∞òÏòÅ)
        const keywordFreq = {
          // ÏµúÏã† Ìï´Ïù¥Ïäà (ÎÜíÏùÄ ÎπàÎèÑ)
          ÏÜåÏï°Ï£ºÏ£º: 8,
          Ìï©Î≥ë: 7,
          Í≤ΩÏòÅÍ∂å: 6,
          Ï£ºÏ£ºÏ¥ùÌöå: 5,

          // 2Ï∞®Ï†ÑÏßÄ ÏÇ¨ÏóÖ (Ï§ëÍ∞Ñ ÎπàÎèÑ)
          "2Ï∞®Ï†ÑÏßÄ": 9,
          ÏïåÎ£®ÎØ∏ÎäÑÎ∞ï: 8,
          Ï†ÑÍ∏∞Ï∞®: 7,
          Î∞∞ÌÑ∞Î¶¨ÏÜåÏû¨: 6,
          LGÏóêÎÑàÏßÄÏÜîÎ£®ÏÖò: 5,
          SKÏò®: 4,

          // ÏÑ¨Ïú† ÏÇ¨ÏóÖ (Í∏∞Î≥∏ ÎπàÎèÑ)
          ÏÑ¨Ïú†: 6,
          Ìè¥Î¶¨ÏóêÏä§ÌÑ∞: 5,
          ÏßÅÎ¨º: 4,
          ÏõêÏÇ¨: 3,

          // Ìà¨Ïûê Í¥ÄÎ†®
          Ïã§Ï†Å: 7,
          Îß§Ï∂ú: 6,
          ÏòÅÏóÖÏù¥Ïùµ: 5,
          "R&D": 4,
          Ìà¨Ïûê: 5,
          ÏàòÏ£º: 4,

          // ÏãúÏû• Ïù¥Ïäà
          ÏõêÏûêÏû¨Í∞ÄÍ≤©: 4,
          ÌôòÏú®: 3,
          ÏπúÌôòÍ≤Ω: 4,
          ÏßÄÏÜçÍ∞ÄÎä•: 3,

          // Í∏∞ÌÉÄ ÌÇ§ÏõåÎìú
          Ï∞®ÏÑ∏ÎåÄÍ∏∞Ïà†: 3,
          Î¶¨Ìä¨Ïù¥Ïò®: 3,
          Ï†ÑÍ≥†Ï≤¥Î∞∞ÌÑ∞Î¶¨: 2,
          Í∏ÄÎ°úÎ≤å: 3,
          ÏàòÏ∂ú: 2,
        };

        // ÎπàÎèÑÏàú Ï†ïÎ†¨
        const sortedKeywords = Object.entries(keywordFreq)
          .sort(([, a], [, b]) => b - a)
          .slice(0, 15); // ÏÉÅÏúÑ 15Í∞ú

        if (sortedKeywords.length === 0) {
          return '<p style="color: #999; font-style: italic;">ÌÇ§ÏõåÎìú Îç∞Ïù¥ÌÑ∞Í∞Ä ÏóÜÏäµÎãàÎã§.</p>';
        }

        // ÏõåÎìúÌÅ¥ÎùºÏö∞Îìú Ïä§ÌÉÄÏùº ÏÉùÏÑ±
        const maxFreq = sortedKeywords[0][1];
        const colors = [
          "#3498db",
          "#e74c3c",
          "#2ecc71",
          "#f39c12",
          "#9b59b6",
          "#1abc9c",
          "#34495e",
        ];

        return sortedKeywords
          .map(([keyword, freq], index) => {
            const fontSize = Math.max(12, (freq / maxFreq) * 24 + 12);
            const color = colors[index % colors.length];
            const opacity = 0.7 + (freq / maxFreq) * 0.3;

            return `
            <span style="
              font-size: ${fontSize}px;
              color: ${color};
              opacity: ${opacity};
              margin: 5px 8px;
              display: inline-block;
              font-weight: ${freq > 1 ? "bold" : "normal"};
              padding: 4px 8px;
              border-radius: 15px;
              background: ${color}15;
              border: 1px solid ${color}30;
              transition: transform 0.2s ease;
            " 
            onmouseover="this.style.transform='scale(1.1)'"
            onmouseout="this.style.transform='scale(1)'"
            title="Îì±Ïû• ÎπàÎèÑ: ${freq}Ìöå">
              ${keyword}
            </span>
          `;
          })
          .join("");
      }

      function displayAnalysisResults(technical, ai) {
        const contentEl = document.getElementById("analysisContent");

        const signalClass = ai.signal.includes("Îß§Ïàò")
          ? "signal-buy"
          : ai.signal.includes("Îß§ÎèÑ")
          ? "signal-sell"
          : "signal-hold";

        contentEl.innerHTML = `
          <div class="analysis-section">
            <h3>üéØ Ï¢ÖÌï© Ìà¨Ïûê ÏùòÍ≤¨</h3>
            <div style="text-align: center; margin: 20px 0;">
              <span class="signal-indicator ${signalClass}">${ai.signal}</span>
              <p style="margin-top: 10px; font-size: 1.1em;">
                <strong>Ïã†Î¢∞ÎèÑ: ${ai.confidence}%</strong> | 
                Î™©ÌëúÍ∞Ä: <strong>${ai.targetPrice.toLocaleString()}Ïõê</strong> | 
                Ìà¨ÏûêÍ∏∞Í∞Ñ: <strong>${ai.timeHorizon}</strong>
              </p>
            </div>
          </div>

          <div class="analysis-section">
            <h3>ü§ñ AI Ï¢ÖÌï© Î∂ÑÏÑù Î¶¨Ìè¨Ìä∏</h3>
            <div style="background: white; padding: 20px; border-radius: 10px; line-height: 1.8; border: 2px solid #e8e8e8;">
              ${ai.commentary
                .split("\n")
                .map((paragraph) =>
                  paragraph.trim()
                    ? `<p style="margin-bottom: 15px;">${paragraph}</p>`
                    : ""
                )
                .join("")}
            </div>
          </div>

          <div class="analysis-section">
            <h3>üìä Í∏∞Ïà†Ï†Å Î∂ÑÏÑù</h3>
            <p><strong>ÌòÑÏû¨Í∞Ä:</strong> ${technical.currentPrice.toLocaleString()}Ïõê 
               (${
                 technical.priceChangePercent > 0 ? "+" : ""
               }${technical.priceChangePercent.toFixed(2)}%)</p>
            <p><strong>Ï£ºÏöî Ï∂îÏÑ∏:</strong> ${technical.trend}</p>
            <p><strong>Ïù¥ÎèôÌèâÍ∑†:</strong> 
               5Ïùº(${technical.ma5}) | 20Ïùº(${technical.ma20}) | 60Ïùº(${
          technical.ma60
        })</p>
            <p><strong>MACD Ïã†Ìò∏:</strong> ${technical.macdSignal} (${
          technical.macdValue
        })</p>
            <p><strong>RCI:</strong> Îã®Í∏∞(${technical.rci9}) | Ïû•Í∏∞(${
          technical.rci26
        })</p>
            <p><strong>Í±∞ÎûòÎüâ:</strong> ÌèâÍ∑† ÎåÄÎπÑ ${technical.volumeRatio}Î∞∞</p>
            <p><strong>ÏßÄÏßÄÏÑ†:</strong> ${
              technical.support
            }Ïõê | <strong>Ï†ÄÌï≠ÏÑ†:</strong> ${technical.resistance}Ïõê</p>
          </div>

          <div class="analysis-section">
            <h3>üî§ DIÎèôÏùº ÌïµÏã¨ ÌÇ§ÏõåÎìú Î∂ÑÏÑù</h3>
            <div style="margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; border-left: 4px solid #3498db;">
              <h4 style="margin: 0 0 15px 0; color: #2c3e50;">Ï£ºÏöî ÌÇ§ÏõåÎìú ÏõåÎìúÌÅ¥ÎùºÏö∞Îìú</h4>
              <div class="wordcloud-container" style="text-align: center; padding: 25px; background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                ${generateWordCloud()}
              </div>
              <p style="margin: 15px 0 0 0; font-size: 0.9em; color: #666; text-align: center;">
                * DIÎèôÏùº Í¥ÄÎ†® ÏµúÏã† Ïù¥Ïäà Î∞è Ìà¨Ïûê ÌÇ§ÏõåÎìúÎ•º ÌÅ¨Í∏∞Î≥ÑÎ°ú ÌëúÏãú
              </p>
            </div>
          </div>

          <div class="analysis-section">
            <h3>‚ö†Ô∏è Ìà¨Ïûê Ïú†ÏùòÏÇ¨Ìï≠</h3>
            <p>‚Ä¢ Î≥∏ Î∂ÑÏÑùÏùÄ Í≥ºÍ±∞ Îç∞Ïù¥ÌÑ∞ÏôÄ Í≥µÍ∞ú Ï†ïÎ≥¥Ïóê Í∏∞Î∞òÌïú Ï∞∏Í≥†ÏûêÎ£åÏûÖÎãàÎã§.</p>
            <p>‚Ä¢ Ïã§Ï†ú Ìà¨Ïûê Í≤∞Ï†ïÏùÄ Í∞úÎ≥Ñ Ìà¨ÏûêÏûêÏùò ÌåêÎã®Í≥º Ï±ÖÏûÑ ÌïòÏóê Ïù¥Î£®Ïñ¥Ï†∏Ïïº Ìï©ÎãàÎã§.</p>
            <p>‚Ä¢ Ï£ºÏãù Ìà¨ÏûêÎäî ÏõêÍ∏à ÏÜêÏã§Ïùò ÏúÑÌóòÏù¥ ÏûàÏúºÎ©∞, Î∂ÑÏÇ∞Ìà¨ÏûêÎ•º Í∂åÏû•Ìï©ÎãàÎã§.</p>
            <p>‚Ä¢ ÏúÑÌóò ÏàòÏ§Ä: <strong>${ai.riskLevel}</strong></p>
          </div>

          <div style="text-align: center; margin-top: 30px; padding: 20px; background: #f0f0f0; border-radius: 10px;">
            <p style="margin: 0 0 5px 0; color: #666; font-size: 0.9em;">
              ü§ñ AI Î∂ÑÏÑù ÏôÑÎ£å: ${new Date().toLocaleString()} | 
              Îç∞Ïù¥ÌÑ∞ Í∏∞Ï§Ä: ${stockData[stockData.length - 1].localDate}
            </p>
            <p style="margin: 0; color: #888; font-size: 0.8em;">
              üì∞ Îâ¥Ïä§ Îç∞Ïù¥ÌÑ∞ Ï∂úÏ≤ò: 
              <a href="https://finance.naver.com/item/news.naver?code=001530" target="_blank" style="color: #3498db; text-decoration: none;">
                ÎÑ§Ïù¥Î≤Ñ Í∏àÏúµ(Naver Finance)
              </a> | 
              ÎÑ§Ïù¥Î≤Ñ Ï£ºÏãù Ï¢ÖÎ™© Îâ¥Ïä§
            </p>
          </div>
        `;
      }

      // Ï¥àÍ∏∞Ìôî
      window.addEventListener("load", function () {
        console.log("üìä DI Ï£ºÏãù ÎåÄÏãúÎ≥¥Îìú Ï¥àÍ∏∞Ìôî Ï§ë...");
        console.log(`‚úÖ Ï†ÑÏ≤¥ ${stockData.length}Í∞ú Îç∞Ïù¥ÌÑ∞ Ìè¨Ïù∏Ìä∏ Î°úÎìú ÏôÑÎ£å`);
        initializeStats();
        createPriceChart();
        createVolumeChart();
        createMACDChart();
        createRCIChart();
        createForeignChart();
        console.log("üéâ ÎåÄÏãúÎ≥¥Îìú Î°úÎìú ÏôÑÎ£å!");
      });
    </script>
  </body>
</html>
